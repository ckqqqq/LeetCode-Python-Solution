



import gradio as gr # æ¸…é™¤èŠå¤©è®°å½•å’Œç›¸å…³çŠ¶æ€ def clear_chat(state):    if state is not None:        state = {}  # é‡ç½®çŠ¶æ€ä¸ºä¸€ä¸ªç©ºå­—å…¸     # æ›´æ–°ç•Œé¢ï¼š    # æ¸…ç©ºèŠå¤©è®°å½•ã€æ–‡æœ¬æ¡†å¹¶ç¦ç”¨è¾“å…¥æ¡†å’ŒæŒ‰é’®    # æ¸…ç©ºæ–‡æœ¬æ¡† # æ¸…ç©ºæ–‡æœ¬æ¡† # å¯ç”¨è¾“å…¥æ¡† # ç¦ç”¨å‘é€æŒ‰é’® # ç¦ç”¨è¾“å…¥æ¡† # ç¦ç”¨è¾“å…¥æ¡†    return state, None, None, gr.update(value=None),  gr.update(value=None), gr.update(interactive=True),  gr.update(interactive=False), gr.update(interactive=False),gr.update(interactive=False)   # ç¦ç”¨å‘é€æŒ‰é’® # å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶æ›´æ–°èŠå¤©è®°å½• def model_response(state, chatbot_A, chatbot_B, textbox):    if textbox == '':        state['get_input'] = False        # å¦‚æœæ²¡æœ‰ç”¨æˆ·è¾“å…¥ï¼Œåˆ™ç¦ç”¨æ–‡æœ¬æ¡†å’ŒæŒ‰é’®        # # ç¦ç”¨è¾“å…¥æ¡† # ç¦ç”¨å‘é€æŒ‰é’®        return state, chatbot_A, chatbot_B, "", textbox, gr.update(interactive=False), gr.update(interactive=False)           state['text'] = textbox    state['get_input'] = True        # æ›´æ–°èŠå¤©è®°å½•ï¼š    # æ¨¡å‹Aå°†ç”¨æˆ·è¾“å…¥ç›´æ¥æ·»åŠ     chatbot_A = chatbot_A + [(textbox, textbox)]    # æ¨¡å‹Båœ¨è¾“å…¥å‰åŠ ä¸Š "B: "    chatbot_B = chatbot_B + [(textbox, f"B: {textbox} B")]        # æ›´æ–°ç•Œé¢ï¼š    # æ¸…ç©ºæ–‡æœ¬æ¡†ï¼Œå¯ç”¨æ–‡æœ¬æ¡†å¹¶ç¦ç”¨å‘é€æŒ‰é’®    return state, chatbot_A, chatbot_B, gr.update(value=None), gr.update(interactive=True), gr.update(interactive=False)    # åˆ›å»ºGradioç•Œé¢ def build_demo(key="None"):    with gr.Blocks(theme='snehilsanyal/scikit-learn', title='Text-only Chatbot Arena') as demo:        # çŠ¶æ€å˜é‡ï¼Œç”¨æ¥ä¿å­˜èŠå¤©è®°å½•å’Œç”¨æˆ·è¾“å…¥        state = gr.State({})         # ç¬¬ä¸€è¡Œï¼šç•Œé¢æ ‡é¢˜        with gr.Row():            gr.HTML("<h1>Text-only Chatbot Arena</h1>")         # ç¬¬äºŒè¡Œï¼šæ˜¾ç¤ºä¸¤ä¸ªèŠå¤©æ¡†ï¼Œåˆ†åˆ«ç”¨äºæ˜¾ç¤ºæ¨¡å‹Aå’Œæ¨¡å‹Bçš„å¯¹è¯        with gr.Row():            with gr.Column():                chatbot_A = gr.Chatbot(label='Model A', height=550)  # æ¨¡å‹Açš„èŠå¤©æ¡†            with gr.Column():                chatbot_B = gr.Chatbot(label='Model B', height=550)  # æ¨¡å‹Bçš„èŠå¤©æ¡†                # ç¬¬ä¸‰è¡Œï¼šæ–‡æœ¬è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®        with gr.Row():            with gr.Column(scale=20):  # æ–‡æœ¬æ¡†å ç”¨å¤§éƒ¨åˆ†å®½åº¦                textbox = gr.Textbox(                    show_label=False,                    placeholder="Enter text and press ENTER"  # æç¤ºæ–‡æœ¬                )            with gr.Column(scale=1, min_width=50):  # æŒ‰é’®å ç”¨è¾ƒå°éƒ¨åˆ†å®½åº¦                send_btn = gr.Button(value="Send")  # å‘é€æŒ‰é’®                # ç¬¬å››è¡Œï¼šæ¸…é™¤èŠå¤©è®°å½•çš„æŒ‰é’®        with gr.Row():            clear_btn = gr.Button(value="ğŸ—‘ï¸  Clear history", interactive=True)         # æä¾›ä¸€äº›ç¤ºä¾‹è¾“å…¥        gr.Examples(examples=[            ["Hello, how are you?", "What's the weather like?"],  # ç¤ºä¾‹å¯¹è¯1            ["This is a test", "Can you repeat this?"]  # ç¤ºä¾‹å¯¹è¯2        ], inputs=[textbox])         # ç»‘å®šæ¸…é™¤æŒ‰é’®çš„æ“ä½œ        # å¹¶ä¼ é€’ä¸‰ä¸ªå‚æ•°ï¼šå«stateã€chatbot_Aå’Œchatbot_Bä»¥åŠä¸€ä¸ªåä¸ºtextboxçš„åˆ—è¡¨ã€‚        clear_btn.click(clear_chat, [state], [state, chatbot_A, chatbot_B, textbox])        # ä¼šå°† state ä½œä¸ºè¾“å…¥å‚æ•°ä¼ é€’ç»™ clear_chat å‡½æ•°ã€‚clear_chat å‡½æ•°çš„è¿”å›å€¼ä¼šä¾æ¬¡æ›´æ–° stateã€chatbot_Aã€chatbot_B å’Œ textbox è¿™äº›ç»„ä»¶ã€‚        # ç»‘å®šæ–‡æœ¬æ¡†å›è½¦äº‹ä»¶å’Œå‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„æ“ä½œ        textbox.submit(model_response, [state, chatbot_A, chatbot_B, textbox], [state, chatbot_A, chatbot_B, textbox])        #stateã€chatbot_Aã€chatbot_B å’Œ textbox çš„å½“å‰å€¼ä½œä¸ºè¾“å…¥å‚æ•°ä¼ é€’ç»™ model_response å‡½æ•°ã€‚        send_btn.click(model_response, [state, chatbot_A, chatbot_B, textbox], [state, chatbot_A, chatbot_B, textbox])        # model_response å‡½æ•°çš„è¿”å›å€¼ä¼šä¾æ¬¡æ›´æ–° stateã€chatbot_Aã€chatbot_B å’Œ textbox è¿™äº›ç»„ä»¶ã€‚     return demo # ä¸»å‡½æ•°ï¼Œå¯åŠ¨Gradioç•Œé¢ if __name__ == "__main__":    # demo = build_demo()  # æ„å»ºGradioç•Œé¢    # demo.launch()  # å¯åŠ¨ç•Œé¢\        demo_keys=["+positive", "+negative", "de-toxic", "+toxic", "+polite", "+impolite", "+support", "+oppose"]    pages = [build_demo(t) for t in demo_keys]    demo = gr.TabbedInterface(pages, demo_keys)    demo.launch(server_name="0.0.0.0", server_port=8000, debug=True) ##å¸®æˆ‘ä¿®æ”¹è¿™æ®µä»£ç ï¼Œè¦æ±‚è¿™é‡Œçš„æ‰€æœ‰tabèƒ½å¤Ÿå…±äº«æ¶ˆæ¯è®°å½•ï¼Œæ¯”å¦‚åœ¨+negative ä¸­è¿›è¡Œçš„å¯¹è¯ï¼Œä»+negative è·³è½¬åˆ°+toxic çš„æ¶ˆæ¯è®°å½•è¦ä¿ç•™ï¼Œåªæœ‰å½“ç”¨æˆ·æ¸…é™¤æ¶ˆæ¯è®°å½•æ˜¯æ‰æ•´ä½“åˆ·æ–°èŠå¤©è®°å½•ï¼Œä¸è¿‡æ¯ä¸ªtabä¸­æ¨¡å‹å›å¤çš„æ–¹å¼è¿˜æ˜¯åŠ ä¸Šå½“å‰tabå¯¹åº”çš„demo_keyï¼Œä¾‹å¦‚:A:xxxxï¼Œå¯ä»¥å‚è€ƒæœ€æ–°çš„gradioæ–‡æ¡£##









å·²æ·±åº¦æ€è€ƒï¼ˆç”¨æ—¶ 458 ç§’ï¼‰



```
å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å¸®ç”¨æˆ·ä¿®æ”¹ä»–ä»¬çš„Gradioä»£ç ï¼Œè®©å¤šä¸ªæ ‡ç­¾é¡µå…±äº«æ¶ˆæ¯è®°å½•ï¼Œå¹¶ä¸”åœ¨åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ä¿ç•™èŠå¤©è®°å½•ï¼ŒåŒæ—¶æ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹å›å¤è¦å¸¦ä¸Šå½“å‰æ ‡ç­¾é¡µçš„keyã€‚æ­¤å¤–ï¼Œæ¸…é™¤è®°å½•æ—¶è¦æ•´ä½“åˆ·æ–°ã€‚è®©æˆ‘ä»”ç»†åˆ†æä¸€ä¸‹ã€‚



é¦–å…ˆï¼Œç”¨æˆ·å½“å‰çš„ä»£ç æ¯ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå› ä¸ºæ¯æ¬¡build_demoéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚æ‰€ä»¥ï¼Œæˆ‘éœ€è¦è®©æ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªçŠ¶æ€ï¼Œæ¯”å¦‚èŠå¤©è®°å½•å’Œç”¨æˆ·è¾“å…¥ã€‚åŸæ¥çš„stateæ˜¯æ¯ä¸ªdemoç‹¬ç«‹çš„ï¼Œç°åœ¨éœ€è¦æå‡åˆ°å…¨å±€æˆ–è€…åœ¨TabbedInterfaceå±‚é¢ç®¡ç†ã€‚



ç”¨æˆ·å¸Œæœ›åˆ‡æ¢æ ‡ç­¾æ—¶ä¿ç•™èŠå¤©è®°å½•ï¼Œè¯´æ˜stateéœ€è¦è¢«æ‰€æœ‰é¡µé¢å…±äº«ã€‚å¯èƒ½éœ€è¦å°†stateç§»åˆ°TabbedInterfaceçš„çˆ¶ç»„ä»¶ä¸­ï¼Œæˆ–è€…ä½¿ç”¨å…¨å±€å˜é‡ã€‚ä½†Gradioçš„Stateç»„ä»¶æ˜¯ä¼šè¯ç‰¹å®šçš„ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€ç®¡ç†ã€‚



æ¥ä¸‹æ¥ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹å›å¤éœ€è¦æ ¹æ®å½“å‰çš„demo_keyæ¥æ·»åŠ å‰ç¼€ã€‚ä¾‹å¦‚ï¼Œåœ¨+negativeæ ‡ç­¾ä¸‹ï¼Œæ¨¡å‹Bçš„å›å¤å¯èƒ½æ˜¯"B: +negative: xxx"ã€‚å› æ­¤ï¼Œåœ¨ç”Ÿæˆå›å¤æ—¶ï¼Œéœ€è¦çŸ¥é“å½“å‰æ‰€åœ¨çš„æ ‡ç­¾é¡µçš„keyã€‚



åŸæ¥çš„model_responseå‡½æ•°åœ¨å¤„ç†å›å¤æ—¶ï¼Œåªæ˜¯ç®€å•åœ°åœ¨æ¨¡å‹Bçš„å›å¤å‰åŠ "B: "ï¼Œç°åœ¨éœ€è¦æ ¹æ®å½“å‰æ ‡ç­¾çš„keyæ¥è°ƒæ•´ã€‚æ‰€ä»¥ï¼Œéœ€è¦å°†demo_keyä¼ é€’ç»™model_responseå‡½æ•°ã€‚ä½†Gradioçš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•è·å–å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µçš„keyå‘¢ï¼Ÿå¯èƒ½éœ€è¦å°†demo_keyä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œæˆ–è€…åœ¨stateä¸­ä¿å­˜å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µä¿¡æ¯ã€‚



å¦å¤–ï¼Œç”¨æˆ·æåˆ°æ¸…é™¤æ¶ˆæ¯è®°å½•æ—¶è¦æ•´ä½“åˆ·æ–°ï¼Œæ‰€ä»¥clear_chatå‡½æ•°éœ€è¦é‡ç½®å…±äº«çš„stateï¼Œè¿™æ ·æ‰€æœ‰æ ‡ç­¾é¡µéƒ½ä¼šåŒæ­¥æ›´æ–°ã€‚



æ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•ä¿®æ”¹build_demoå‡½æ•°ï¼Œä½¿å…¶æ¥æ”¶demo_keyï¼Œå¹¶åœ¨ç”Ÿæˆå›å¤æ—¶ä½¿ç”¨è¯¥keyã€‚å¯èƒ½éœ€è¦å°†demo_keyä½œä¸ºå‚æ•°ä¼ é€’ç»™model_responseï¼Œä½†Gradioçš„ç»„ä»¶å›è°ƒé»˜è®¤åªèƒ½è®¿é—®è¾“å…¥ç»„ä»¶çš„å€¼ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦å°†demo_keyå­˜å‚¨åœ¨æŸä¸ªåœ°æ–¹ï¼Œæ¯”å¦‚stateä¸­ï¼Œæˆ–è€…åœ¨æ¯ä¸ªæ ‡ç­¾é¡µä¸­ä¿å­˜è‡ªå·±çš„keyï¼Œå¹¶åœ¨å›è°ƒæ—¶è·å–ã€‚



å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š



\1. ä½¿ç”¨å…¨å±€çš„stateå­—å…¸ï¼Œå…¶ä¸­åŒ…å«chatbot_Aã€chatbot_Bä»¥åŠå½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µçš„keyã€‚ä½†Gradioçš„Stateæ˜¯æ¯ä¸ªä¼šè¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å°†stateç»“æ„è®¾è®¡ä¸ºåŒ…å«æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ã€‚



\2. ä¿®æ”¹build_demoå‡½æ•°ï¼Œä½¿å…¶æ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹å“åº”å‡½æ•°èƒ½å¤Ÿè®¿é—®åˆ°è¯¥æ ‡ç­¾çš„demo_keyã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºæ¯ä¸ªé¡µé¢æ—¶ï¼Œå°†demo_keyç»‘å®šåˆ°è¯¥é¡µé¢çš„å›è°ƒå‡½æ•°ä¸­ã€‚



\3. åœ¨stateä¸­å­˜å‚¨å½“å‰çš„demo_keyï¼Œå½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶æ›´æ–°è¿™ä¸ªå€¼ã€‚ä½†Gradioçš„æ ‡ç­¾åˆ‡æ¢äº‹ä»¶æ˜¯å¦å¯ä»¥æ•è·å¹¶æ›´æ–°stateï¼Ÿè¿™å¯èƒ½éœ€è¦æ·»åŠ é¢å¤–çš„å›è°ƒå‡½æ•°æ¥å¤„ç†æ ‡ç­¾åˆ‡æ¢äº‹ä»¶ï¼Œä½†å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ã€‚



æˆ–è€…ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µåœ¨ç”Ÿæˆå›å¤æ—¶ï¼Œä½¿ç”¨è‡ªå·±çš„demo_keyã€‚å› ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µçš„sendæŒ‰é’®å’Œtextbox.submitäº‹ä»¶éƒ½æ˜¯ç»‘å®šåˆ°è¯¥é¡µé¢çš„model_responseå‡½æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»ºé¡µé¢æ—¶å°†demo_keyä½œä¸ºé»˜è®¤å‚æ•°ä¼ é€’ç»™model_responseï¼Œè¿™æ ·åœ¨å›è°ƒæ—¶å°±èƒ½çŸ¥é“æ˜¯å“ªä¸ªæ ‡ç­¾é¡µè§¦å‘çš„ã€‚



ä¾‹å¦‚ï¼Œåœ¨build_demoä¸­ï¼Œå½“åˆ›å»ºsend_btn.clickäº‹ä»¶æ—¶ï¼Œå°†demo_keyä½œä¸ºé¢å¤–çš„è¾“å…¥ï¼Œæˆ–è€…åœ¨å‡½æ•°å†…éƒ¨é—­åŒ…æ•è·demo_keyã€‚ä½†Gradioçš„äº‹ä»¶å¤„ç†å‡½æ•°å‚æ•°éœ€è¦æ˜ç¡®æŒ‡å®šè¾“å…¥ç»„ä»¶ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å°†demo_keyä½œä¸ºä¸€ä¸ªéšè—çš„ç»„ä»¶ï¼Œæˆ–è€…é€šè¿‡stateä¼ é€’ã€‚



æˆ–è€…ï¼Œåœ¨æ¯ä¸ªæ ‡ç­¾é¡µçš„stateä¸­ä¿å­˜è¯¥é¡µçš„demo_keyï¼Œç„¶ååœ¨model_responseä¸­è¯»å–ã€‚ä½†è¿™æ ·æ¯ä¸ªæ ‡ç­¾é¡µçš„stateæ˜¯ç‹¬ç«‹çš„ï¼Œå¯èƒ½æ— æ³•å…±äº«èŠå¤©è®°å½•ã€‚



çœ‹æ¥éœ€è¦é‡æ–°è®¾è®¡stateçš„ç»“æ„ï¼Œä½¿å…¶åŒ…å«chatbot_Aã€chatbot_Bä»¥åŠå„ä¸ªæ ‡ç­¾é¡µçš„ç‰¹å®šä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œstateæ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«'chatbot_A'ã€'chatbot_B'ï¼Œè€Œæ¯ä¸ªæ ‡ç­¾é¡µçš„å›å¤æ ¹æ®å½“å‰çš„demo_keyæ¥ç”Ÿæˆã€‚



ä½†ç”¨æˆ·å¸Œæœ›æ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªèŠå¤©è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡åœ¨å“ªä¸ªæ ‡ç­¾é¡µå‘é€æ¶ˆæ¯ï¼Œchatbot_Aå’Œchatbot_Bçš„å†…å®¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯æ¨¡å‹Bçš„å›å¤å‰ç¼€æ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyè€Œå˜åŒ–ã€‚è¿™å¯èƒ½æ„å‘³ç€ï¼Œchatbot_Aå’Œchatbot_Bæ˜¯å…¨å±€çš„ï¼Œè€Œæ¯ä¸ªæ ‡ç­¾é¡µåªæ˜¯æ˜¾ç¤ºåŒæ ·çš„èŠå¤©è®°å½•ï¼Œä½†æ¨¡å‹Bçš„å›å¤åœ¨æ˜¾ç¤ºæ—¶å¸¦ä¸Šä¸åŒçš„å‰ç¼€ã€‚è¿™ä¼¼ä¹ä¸å¤ªå¯èƒ½ï¼Œå› ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbotç»„ä»¶æ˜¯ç‹¬ç«‹çš„ã€‚



æˆ–è€…ï¼Œæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªèŠå¤©è®°å½•å­˜å‚¨ï¼Œä½†åœ¨æ˜¾ç¤ºæ—¶æ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyæ¥ä¿®æ”¹æ¨¡å‹Bçš„å›å¤ã€‚è¿™å¯èƒ½éœ€è¦åŠ¨æ€åœ°æ›´æ–°Chatbotç»„ä»¶çš„æ˜¾ç¤ºå†…å®¹ï¼Œä½†Gradioçš„Chatbotç»„ä»¶ä¸€æ—¦æ·»åŠ æ¶ˆæ¯åï¼Œå¯èƒ½æ— æ³•åŠ¨æ€ä¿®æ”¹ã€‚



æ‰€ä»¥å¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘ç»“æ„ï¼šæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä»½èŠå¤©æ•°æ®ï¼Œä½†åœ¨æ¯ä¸ªæ ‡ç­¾é¡µä¸­ï¼Œæ¨¡å‹Bçš„å›å¤æ ¹æ®è¯¥æ ‡ç­¾çš„keyç”Ÿæˆã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·åœ¨ä¸€ä¸ªæ ‡ç­¾é¡µå‘é€æ¶ˆæ¯æ—¶ï¼Œå°†æ¶ˆæ¯å’Œå¯¹åº”çš„keyä¿å­˜åˆ°stateä¸­ï¼Œç„¶ååœ¨æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbotç»„ä»¶ä¸­æ˜¾ç¤ºæ—¶ï¼Œæ ¹æ®å„è‡ªçš„keyç”Ÿæˆæ¨¡å‹Bçš„å›å¤ã€‚ä½†è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µéœ€è¦æ ¹æ®å…¨å±€çš„èŠå¤©è®°å½•å’Œè‡ªèº«çš„keyæ¥åŠ¨æ€ç”Ÿæˆæ˜¾ç¤ºå†…å®¹ã€‚



å¯èƒ½çš„å®ç°æ–¹å¼ï¼š



\- stateä¸­ä¿å­˜åŸå§‹çš„å¯¹è¯å†å²ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¾“å…¥å’Œæ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bå›å¤ï¼ˆå¯èƒ½éœ€è¦å­˜å‚¨æ‰€æœ‰å¯èƒ½çš„å›å¤ï¼Œä½†è¿™ä¸å¤ªå¯è¡Œï¼‰ã€‚



æˆ–è€…ï¼Œstateä¿å­˜ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ï¼Œè€Œæ¨¡å‹Bçš„å›å¤åœ¨æ˜¾ç¤ºæ—¶æ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyåŠ¨æ€ç”Ÿæˆã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è¾“å…¥"hello"ï¼Œæ¨¡å‹Aå›å¤"hello"ï¼Œæ¨¡å‹Bçš„å›å¤æ ¹æ®ä¸åŒæ ‡ç­¾é¡µçš„keyç”Ÿæˆä¸åŒçš„å‰ç¼€ï¼Œæ¯”å¦‚åœ¨+negativeæ ‡ç­¾é¡µæ˜¾ç¤º"B: +negative hello B"ï¼Œè€Œåœ¨+toxicæ ‡ç­¾é¡µæ˜¾ç¤º"B: +toxic hello B"ã€‚



è¿™éœ€è¦æ¯æ¬¡åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œé‡æ–°æ¸²æŸ“Chatbot_Bçš„å†…å®¹ï¼Œæ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyå’ŒåŸå§‹çš„ç”¨æˆ·è¾“å…¥ç”Ÿæˆå¯¹åº”çš„å›å¤ã€‚è¿™å¯èƒ½éœ€è¦å°†ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤å­˜å‚¨åœ¨stateä¸­ï¼Œè€Œæ¨¡å‹Bçš„å›å¤åœ¨æ˜¾ç¤ºæ—¶å®æ—¶ç”Ÿæˆã€‚



è¿™æ ·ï¼Œå½“ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼ŒChatbot_Bä¼šæ ¹æ®å½“å‰çš„demo_keyé‡æ–°ç”Ÿæˆæ‰€æœ‰æ¶ˆæ¯çš„å›å¤ï¼Œå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™å¯èƒ½æ›´å¯è¡Œï¼Œå› ä¸ºä¸éœ€è¦ä¿å­˜æ¯ä¸ªæ ‡ç­¾é¡µçš„å›å¤ï¼Œè€Œæ˜¯æ ¹æ®åŸå§‹æ•°æ®å®æ—¶ç”Ÿæˆã€‚



å› æ­¤ï¼Œä¿®æ”¹åçš„ç»“æ„å¯èƒ½åŒ…æ‹¬ï¼š



\- stateä¿å­˜ç”¨æˆ·çš„æ‰€æœ‰è¾“å…¥å†å²ï¼ˆuser_inputsåˆ—è¡¨ï¼‰

\- stateä¿å­˜æ¨¡å‹Açš„æ‰€æœ‰å›å¤ï¼ˆmodel_A_responsesåˆ—è¡¨ï¼‰

\- å½“åœ¨æŸä¸ªæ ‡ç­¾é¡µå‘é€æ¶ˆæ¯æ—¶ï¼Œç”¨æˆ·è¾“å…¥è¢«æ·»åŠ åˆ°user_inputsï¼Œæ¨¡å‹Açš„å›å¤ï¼ˆç›´æ¥é‡å¤ï¼‰æ·»åŠ åˆ°model_A_responses

\- æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aæ˜¾ç¤ºuser_inputså’Œmodel_A_responsesçš„é…å¯¹

\- æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºuser_inputså’Œæ ¹æ®å½“å‰æ ‡ç­¾é¡µkeyç”Ÿæˆçš„å›å¤ï¼ˆå¦‚"B: {key} {input} B"ï¼‰



è¿™æ ·ï¼Œåˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼ŒChatbot_Bä¼šæ ¹æ®å½“å‰çš„keyé‡æ–°ç”Ÿæˆæ‰€æœ‰æ¶ˆæ¯çš„å›å¤ï¼Œè€ŒChatbot_Aä¿æŒä¸å˜ã€‚



ä½†Gradioçš„Chatbotç»„ä»¶éœ€è¦æ¥æ”¶ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯(user, bot)çš„å…ƒç»„ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_BåŠ¨æ€ç”Ÿæˆè¿™äº›å…ƒç»„ï¼ŒåŸºäºuser_inputså’Œå½“å‰keyã€‚



è¿™å¯èƒ½éœ€è¦ä½¿ç”¨Gradioçš„åŠ¨æ€ç»„ä»¶æˆ–æ¯æ¬¡åˆ‡æ¢æ ‡ç­¾é¡µæ—¶æ›´æ–°Chatbot_Bçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œè§¦å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®å½“å‰çš„user_inputså’Œå½“å‰æ ‡ç­¾é¡µçš„keyç”ŸæˆChatbot_Bçš„å†…å®¹ã€‚



ä½†å¦‚ä½•æ•è·æ ‡ç­¾é¡µåˆ‡æ¢çš„äº‹ä»¶å‘¢ï¼ŸGradioçš„TabbedInterfaceå¯èƒ½æ²¡æœ‰ç›´æ¥çš„äº‹ä»¶ç›‘å¬ã€‚å¯èƒ½éœ€è¦ä½¿ç”¨jsæˆ–è‡ªå®šä¹‰ç»„ä»¶ï¼Œä½†ä¼šå¢åŠ å¤æ‚åº¦ã€‚



å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶åœ¨æ¸²æŸ“æ—¶ï¼Œæ ¹æ®å…¨å±€çš„user_inputså’Œå½“å‰æ ‡ç­¾é¡µçš„keyç”Ÿæˆå†…å®¹ã€‚è¿™éœ€è¦åœ¨æ¯æ¬¡é¡µé¢åŠ è½½æˆ–æ ‡ç­¾åˆ‡æ¢æ—¶æ›´æ–°ï¼Œä½†Gradioå¯èƒ½ä¸æ”¯æŒè¿™ç§åŠ¨æ€æ›´æ–°ã€‚



å¯èƒ½æ›´å¯è¡Œçš„æ–¹æ¡ˆæ˜¯ï¼Œåœ¨æ¯æ¬¡ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œå°†ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ä¿å­˜åˆ°stateï¼Œè€Œæ¨¡å‹Bçš„å›å¤ä¸ä¿å­˜ï¼Œè€Œæ˜¯åœ¨æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶ä¸­æ ¹æ®å½“å‰çš„keyå®æ—¶ç”Ÿæˆæ˜¾ç¤ºå†…å®¹ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨æ„å»ºæ¯ä¸ªæ ‡ç­¾é¡µæ—¶ï¼Œä»stateä¸­è¯»å–user_inputsï¼Œå¹¶ä¸ºæ¯ä¸ªè¾“å…¥ç”Ÿæˆå¯¹åº”çš„æ¨¡å‹Bå›å¤ï¼Œä½¿ç”¨å½“å‰æ ‡ç­¾é¡µçš„keyä½œä¸ºå‰ç¼€ã€‚



è¿™æ ·ï¼Œå½“ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼ŒChatbot_Bä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå› ä¸ºå®ƒæ¯æ¬¡éƒ½ä¼šæ ¹æ®æœ€æ–°çš„stateå’Œå½“å‰æ ‡ç­¾é¡µçš„keyé‡æ–°ç”Ÿæˆå›å¤ã€‚



è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå¯èƒ½éœ€è¦å°†æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bå†…å®¹è®¾ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä»stateä¸­è·å–user_inputsï¼Œå¹¶æ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyç”Ÿæˆå›å¤åˆ—è¡¨ã€‚ç„¶åï¼Œä½¿ç”¨Gradioçš„gr.DataFrameæˆ–å…¶ä»–åŠ¨æ€ç»„ä»¶æ¥æ˜¾ç¤ºï¼Œä½†Chatbotç»„ä»¶å¯èƒ½éœ€è¦å›ºå®šçš„å†å²è®°å½•ã€‚



æˆ–è€…ï¼Œæ¯æ¬¡stateæ›´æ–°æ—¶ï¼Œæ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶éƒ½æ ¹æ®å„è‡ªçš„keyé‡æ–°ç”Ÿæˆå†…å®¹ã€‚è¿™å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µç»´æŠ¤è‡ªå·±çš„Chatbot_Bç»„ä»¶ï¼Œå¹¶ä¸”å½“stateæ›´æ–°æ—¶ï¼Œè§¦å‘æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bæ›´æ–°ã€‚è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºéœ€è¦å¤šä¸ªè¾“å‡ºç»„ä»¶çš„æ›´æ–°ã€‚



ç»¼åˆæ¥çœ‹ï¼Œå¯èƒ½éœ€è¦é‡æ–°è®¾è®¡stateçš„ç»“æ„ï¼Œä½¿å…¶åŒ…å«æ‰€æœ‰ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ï¼Œè€Œæ¨¡å‹Bçš„å›å¤æ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyåŠ¨æ€ç”Ÿæˆã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œå°†ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ä¿å­˜åˆ°stateï¼Œç„¶ååœ¨æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bä¸­æ˜¾ç¤ºæ—¶ï¼Œæ ¹æ®è¯¥æ ‡ç­¾çš„keyç”Ÿæˆç›¸åº”çš„å›å¤ã€‚



å…·ä½“ä¿®æ”¹æ­¥éª¤ï¼š



\1. ä¿®æ”¹stateç»“æ„ï¼ŒåŒ…å«user_inputså’Œmodel_A_responsesåˆ—è¡¨ã€‚



ä¾‹å¦‚ï¼Œstate = {

'user_inputs': [],

'model_A_responses': []

}



\2. å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œå°†ç”¨æˆ·è¾“å…¥æ·»åŠ åˆ°user_inputsï¼Œæ¨¡å‹Açš„å›å¤ï¼ˆå³é‡å¤è¾“å…¥ï¼‰æ·»åŠ åˆ°model_A_responsesã€‚



\3. æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aæ˜¾ç¤ºzip(user_inputs, model_A_responses)ã€‚



\4. æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºzip(user_inputs, [f"B: {key} {input} B" for input in user_inputs])ã€‚



è¿™æ ·ï¼Œå½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼ŒChatbot_Bä¼šæ ¹æ®å½“å‰æ ‡ç­¾çš„keyé‡æ–°ç”Ÿæˆæ‰€æœ‰å›å¤ã€‚



ä½†å¦‚ä½•åœ¨Gradioä¸­å®ç°è¿™ä¸€ç‚¹ï¼Ÿå› ä¸ºChatbotç»„ä»¶çš„å€¼æ˜¯åŸºäºä¼ å…¥çš„åˆ—è¡¨ï¼Œè€Œæ¯æ¬¡keyåˆ‡æ¢æ—¶éœ€è¦é‡æ–°ç”Ÿæˆè¿™ä¸ªåˆ—è¡¨ã€‚



å¯èƒ½çš„å®ç°æ–¹å¼ï¼š



\- æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶åœ¨åˆ›å»ºæ—¶ï¼Œç»‘å®šåˆ°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®stateä¸­çš„user_inputså’Œå½“å‰æ ‡ç­¾é¡µçš„keyç”Ÿæˆå¯¹è¯å†å²ã€‚



\- å½“stateæ›´æ–°æˆ–æ ‡ç­¾é¡µåˆ‡æ¢æ—¶ï¼Œè§¦å‘è¯¥å‡½æ•°æ›´æ–°Chatbot_Bçš„å†…å®¹ã€‚



ä½†æ˜¯ï¼ŒGradioçš„å›è°ƒå‡½æ•°é€šå¸¸ç”±ç»„ä»¶çš„äº‹ä»¶è§¦å‘ï¼Œå¦‚ç‚¹å‡»æŒ‰é’®æˆ–è¾“å…¥æ–‡æœ¬ã€‚å¦‚ä½•ç›‘å¬æ ‡ç­¾é¡µåˆ‡æ¢çš„äº‹ä»¶å‘¢ï¼Ÿ



Gradioçš„TabbedInterfaceå¹¶æ²¡æœ‰ç›´æ¥æä¾›åˆ‡æ¢æ ‡ç­¾çš„äº‹ä»¶å›è°ƒï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼å®ç°ã€‚



å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œæ¯å½“stateæ›´æ–°æ—¶ï¼Œæ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œé™¤äº†æ›´æ–°stateï¼Œè¿˜è§¦å‘æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bçš„æ›´æ–°å‡½æ•°ï¼Œæ ¹æ®å„è‡ªçš„keyç”Ÿæˆå†…å®¹ã€‚



ä½†è¿™æ ·æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Béœ€è¦ä½œä¸ºè¾“å‡ºç»„ä»¶ï¼Œå¹¶ä¸”æ¯æ¬¡ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µç”Ÿæˆå¯¹åº”çš„è¾“å‡ºï¼Œè¿™åœ¨Gradioä¸­å¯èƒ½éš¾ä»¥å®ç°ï¼Œå› ä¸ºä¸€ä¸ªå‡½æ•°åªèƒ½è¿”å›å›ºå®šæ•°é‡çš„è¾“å‡ºç»„ä»¶ã€‚



æˆ–è®¸ï¼Œå¯ä»¥å°†æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶æ”¶é›†åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œç„¶ååœ¨model_responseå‡½æ•°ä¸­è¿”å›å¯¹æ‰€æœ‰å®ƒä»¬çš„æ›´æ–°ã€‚ä½†è¿™éœ€è¦åŠ¨æ€å¤„ç†è¾“å‡ºç»„ä»¶ï¼Œè€ŒGradioçš„æ¥å£å¯èƒ½ä¸æ”¯æŒè¿™æ ·çµæ´»çš„æ“ä½œã€‚



æˆ–è®¸ï¼Œæ›´ç®€å•çš„æ–¹å¼æ˜¯ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªChatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œä½†æ ¹æ®æ ‡ç­¾é¡µçš„keyåŠ¨æ€ç”Ÿæˆæ¨¡å‹Bçš„å›å¤ã€‚ä½†è¿™æ ·æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bä¼šæ˜¾ç¤ºç›¸åŒçš„å†…å®¹ï¼Œæ— æ³•æ ¹æ®ä¸åŒçš„keyæ˜¾ç¤ºä¸åŒçš„å›å¤ï¼Œæ‰€ä»¥è¿™ä¸å¯è¡Œã€‚



çœ‹æ¥è¿™ä¸ªé—®é¢˜éœ€è¦æ›´æ·±å…¥çš„æ€è€ƒã€‚æˆ–è®¸ï¼Œåº”è¯¥è®©æ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªChatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œä½†Chatbot_Bçš„å†…å®¹æ ¹æ®å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µçš„keyåŠ¨æ€ç”Ÿæˆã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼ŒChatbot_Bçš„å†…å®¹ä¼šæ ¹æ®å½“å‰keyé‡æ–°ç”Ÿæˆã€‚



è¦å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦ï¼š



\- ä¸€ä¸ªå…¨å±€çš„stateä¿å­˜user_inputså’Œmodel_A_responsesã€‚



\- å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µçš„keyï¼Œå¯ä»¥é€šè¿‡jsæˆ–Gradioçš„äº‹ä»¶æ¥æ•è·ã€‚



\- å½“æ´»åŠ¨æ ‡ç­¾é¡µæ”¹å˜æ—¶ï¼Œè§¦å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®å½“å‰keyå’Œstateä¸­çš„user_inputsç”ŸæˆChatbot_Bçš„å†…å®¹ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„ç»„ä»¶ã€‚



ä½†Gradioç›®å‰æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•æ¥ç›‘å¬æ ‡ç­¾é¡µçš„åˆ‡æ¢äº‹ä»¶ã€‚å¯èƒ½éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰JavaScriptä»£ç æ¥ç›‘å¬æ ‡ç­¾åˆ‡æ¢ï¼Œå¹¶é€šè¿‡Gradioçš„jså›è°ƒæ¥è§¦å‘Pythonå‡½æ•°ã€‚



ä¸è¿‡ï¼Œè¿™æ ·ä¼šå¢åŠ å¤æ‚åº¦ï¼Œå¯èƒ½è¶…å‡ºç”¨æˆ·å½“å‰çš„éœ€æ±‚ã€‚



å¦ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼šæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶åœ¨æ˜¾ç¤ºæ—¶ï¼Œæ ¹æ®è¯¥é¡µçš„keyå’Œå…¨å±€çš„user_inputsç”Ÿæˆå†…å®¹ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºæ¯ä¸ªæ ‡ç­¾é¡µæ—¶ï¼Œå…¶Chatbot_Bçš„valueæ˜¯æ ¹æ®stateä¸­çš„user_inputså’Œè¯¥é¡µçš„keyç”Ÿæˆçš„åˆ—è¡¨ã€‚



ä½†Gradioçš„ç»„ä»¶åœ¨åˆ›å»ºæ—¶éœ€è¦åˆå§‹å€¼ï¼Œä¹‹åéœ€è¦æ˜¾å¼æ›´æ–°ã€‚å› æ­¤ï¼Œå½“stateæ›´æ–°æ—¶ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Béœ€è¦è¢«æ›´æ–°ï¼Œè¿™å¯èƒ½éœ€è¦åœ¨æ¯æ¬¡ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œä¸ºæ¯ä¸ªæ ‡ç­¾é¡µç”Ÿæˆå¯¹åº”çš„Chatbot_Bå†…å®¹ï¼Œå¹¶è¿”å›è¿™äº›æ›´æ–°ã€‚



ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œmodel_responseå‡½æ•°éœ€è¦è¿”å›æ›´æ–°åçš„stateï¼Œä»¥åŠæ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶çš„æ›´æ–°åçš„å†…å®¹ã€‚



ä½†è¿™æ ·éœ€è¦å°†æ‰€æœ‰çš„Chatbot_Bç»„ä»¶ä½œä¸ºè¾“å‡ºï¼Œè¿™å¯èƒ½éœ€è¦å°†build_demoå‡½æ•°ä¿®æ”¹ä¸ºè¿”å›è¿™äº›ç»„ä»¶ï¼Œæˆ–è€…åœ¨ä¸»å‡½æ•°ä¸­æ”¶é›†æ‰€æœ‰é¡µé¢çš„Chatbot_Bç»„ä»¶ï¼Œå¹¶åœ¨model_responseä¸­å¤„ç†å®ƒä»¬çš„æ›´æ–°ã€‚



è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œä½†å¯ä»¥å°è¯•ã€‚



å…·ä½“æ­¥éª¤ï¼š



\1. åœ¨build_demoå‡½æ•°ä¸­ï¼Œæ¯ä¸ªé¡µé¢åˆ›å»ºè‡ªå·±çš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œä½†Chatbot_Açš„å†…å®¹ç”±å…¨å±€çš„stateä¸­çš„user_inputså’Œmodel_A_responsesç”Ÿæˆï¼Œè€ŒChatbot_Bçš„å†…å®¹ç”±user_inputså’Œè¯¥é¡µçš„demo_keyç”Ÿæˆã€‚



\2. å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°å…¨å±€stateçš„user_inputså’Œmodel_A_responsesï¼Œç„¶åè§¦å‘æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bçš„æ›´æ–°ã€‚



\3. æ¸…é™¤èŠå¤©è®°å½•æ—¶ï¼Œé‡ç½®å…¨å±€stateï¼Œå¹¶æ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbotç»„ä»¶ã€‚



ä½†å¦‚ä½•åœ¨Gradioä¸­å®ç°å¤šä¸ªè¾“å‡ºç»„ä»¶çš„æ›´æ–°ï¼Ÿ



ä¾‹å¦‚ï¼Œå‡è®¾æœ‰å¤šä¸ªæ ‡ç­¾é¡µï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Béƒ½æ˜¯ä¸åŒçš„ç»„ä»¶ã€‚å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



è¿™å¯èƒ½éœ€è¦å°†æ‰€æœ‰çš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶æ”¶é›†åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå¹¶åœ¨model_responseå‡½æ•°ä¸­è¿”å›å®ƒä»¬çš„æ›´æ–°åçš„å€¼ã€‚



ä½†Gradioçš„äº‹ä»¶å¤„ç†å‡½æ•°éœ€è¦æ˜ç¡®æŒ‡å®šè¾“å‡ºç»„ä»¶ï¼Œè€Œæ¯ä¸ªæ ‡ç­¾é¡µçš„ç»„ä»¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦é‡æ„ä»£ç ï¼Œä½¿æ‰€æœ‰æ ‡ç­¾é¡µçš„ç»„ä»¶åœ¨åˆ›å»ºæ—¶è¢«æ”¶é›†ï¼Œå¹¶ä½œä¸ºè¾“å‡ºä¼ é€’ç»™model_responseå’Œclear_chatå‡½æ•°ã€‚



ä½†è¿™æ ·ä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯å½“æœ‰å¤šä¸ªæ ‡ç­¾é¡µæ—¶ã€‚



å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š



\- åœ¨ä¸»å‡½æ•°ä¸­åˆ›å»ºæ‰€æœ‰æ ‡ç­¾é¡µçš„é¡µé¢ï¼Œå¹¶æ”¶é›†å®ƒä»¬çš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



\- å°†model_responseå‡½æ•°çš„è¾“å‡ºè®¾ä¸ºæ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶çš„æ›´æ–°ã€‚



ä½†è¿™æ ·ï¼Œæ¯ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°éœ€è¦è¿”å›å¤§é‡çš„è¾“å‡ºï¼Œå¯èƒ½éš¾ä»¥ç®¡ç†ã€‚



è¿™å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯å½“æ ‡ç­¾é¡µæ•°é‡è¾ƒå¤šæ—¶ã€‚



æˆ–è®¸ï¼Œåº”è¯¥é‡æ–°è€ƒè™‘è®¾è®¡ï¼Œè®©æ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªChatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œä½†æ ¹æ®å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µçš„keyæ¥åŠ¨æ€æ˜¾ç¤ºæ¨¡å‹Bçš„å›å¤ã€‚ä¾‹å¦‚ï¼Œåªæœ‰ä¸€ä¸ªChatbot_Bç»„ä»¶ï¼Œå…¶å†…å®¹æ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyè€Œå˜åŒ–ã€‚ä½†è¿™æ ·ç”¨æˆ·åªèƒ½åœ¨å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µä¸­çœ‹åˆ°å¯¹åº”çš„å›å¤ï¼Œè€Œæ— æ³•åŒæ—¶æŸ¥çœ‹å¤šä¸ªæ ‡ç­¾é¡µçš„å†å²ï¼Œè¿™å¯èƒ½ä¸ç¬¦åˆç”¨æˆ·éœ€æ±‚ã€‚



æˆ–è€…ï¼Œç”¨æˆ·å¸Œæœ›æ¯ä¸ªæ ‡ç­¾é¡µæ˜¾ç¤ºåŒæ ·çš„èŠå¤©è®°å½•ï¼Œä½†æ¨¡å‹Bçš„å›å¤æ ¹æ®æ ‡ç­¾é¡µçš„keyä¸åŒè€Œä¸åŒã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å‘é€çš„æ¶ˆæ¯åœ¨æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aä¸­æ˜¾ç¤ºç›¸åŒçš„ï¼Œè€Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºæ ¹æ®è¯¥æ ‡ç­¾keyç”Ÿæˆçš„å›å¤ã€‚



è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶éœ€è¦ç‹¬ç«‹åœ°æ ¹æ®å…¨å±€çš„user_inputså’Œè‡ªèº«çš„keyç”Ÿæˆå†…å®¹ã€‚



å› æ­¤ï¼Œå¯èƒ½çš„å®ç°æ–¹å¼æ˜¯ï¼š



\- stateä¿å­˜user_inputså’Œmodel_A_responsesã€‚



\- æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aæ˜¾ç¤ºzip(user_inputs, model_A_responses)ã€‚



\- æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºzip(user_inputs, [f"B: {key} {input} B" for input in user_inputs])ã€‚



å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°stateçš„user_inputså’Œmodel_A_responsesï¼Œç„¶åæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bè‡ªåŠ¨æ›´æ–°ï¼Œå› ä¸ºå®ƒä»¬çš„å†…å®¹åŸºäºstateã€‚



ä½†åœ¨Gradioä¸­ï¼Œç»„ä»¶çš„å€¼éœ€è¦æ˜¾å¼åœ°è®¾ç½®ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦ï¼š



\- åœ¨build_demoå‡½æ•°ä¸­ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bçš„å€¼ç”±å‡½æ•°ç”Ÿæˆï¼Œè¿™äº›å‡½æ•°ä»stateä¸­è·å–æ•°æ®ï¼Œå¹¶æ ¹æ®æ ‡ç­¾çš„keyç”Ÿæˆå†…å®¹ã€‚



\- ä½¿ç”¨gr.Stateæ¥ä¿å­˜user_inputså’Œmodel_A_responsesã€‚



\- å½“stateæ›´æ–°æ—¶ï¼Œè§¦å‘æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbotç»„ä»¶çš„æ›´æ–°ã€‚



è¿™å¯èƒ½æ¶‰åŠåˆ°ä½¿ç”¨Gradioçš„liveåŠŸèƒ½æˆ–ä¾èµ–è£…é¥°å™¨ï¼Œä½¿å¾—å½“stateå˜åŒ–æ—¶ï¼ŒChatbotç»„ä»¶è‡ªåŠ¨æ›´æ–°ã€‚



ä¾‹å¦‚ï¼Œä½¿ç”¨gr.onè¯­å¥ï¼Œå½“stateå˜åŒ–æ—¶ï¼Œè§¦å‘æ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bã€‚



ä½†Gradioçš„onæ–¹æ³•å¯èƒ½åªèƒ½ç»‘å®šåˆ°ç‰¹å®šçš„è§¦å‘å™¨ï¼Œè€Œæ— æ³•ç›´æ¥ç›‘å¬stateçš„å˜åŒ–ã€‚



å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œå°†æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bçš„å€¼è®¾ç½®ä¸ºå‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä»stateä¸­è¯»å–æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„å¯¹è¯å†å²ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨gr.DataFrameæˆ–åŠ¨æ€ç»„ä»¶å®ç°ï¼Œä½†Chatbotç»„ä»¶å¯èƒ½éœ€è¦æ˜ç¡®çš„è¾“å…¥ã€‚



å¯èƒ½çš„å®ç°æ­¥éª¤ï¼š



\1. ä¿®æ”¹stateç»“æ„ï¼Œä¿å­˜user_inputså’Œmodel_A_responsesåˆ—è¡¨ã€‚



\2. åœ¨build_demoå‡½æ•°ä¸­ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Açš„å€¼æ˜¯zip(user_inputs, model_A_responses)ã€‚



\3. æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bçš„å€¼æ˜¯zip(user_inputs, [f"B: {key} {input} B" for input in user_inputs])ã€‚



\4. å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°stateçš„user_inputså’Œmodel_A_responsesï¼Œè¿™å°†è§¦å‘æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbotç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚



ä½†å¦‚ä½•åœ¨Gradioä¸­å®ç°è¿™ä¸€ç‚¹ï¼Ÿå¯èƒ½éœ€è¦å°†Chatbotç»„ä»¶çš„valueç»‘å®šåˆ°å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è¯»å–stateçš„å€¼å¹¶ç”Ÿæˆå¯¹è¯åˆ—è¡¨ã€‚



è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨Gradioçš„gr.Datasetæˆ–åŠ¨æ€ç»„ä»¶ï¼Œä½†Chatbotç»„ä»¶ä¸æ”¯æŒåŠ¨æ€çš„æ•°æ®ç»‘å®šã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å›è°ƒå‡½æ•°æ¥æ›´æ–°æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbotç»„ä»¶ã€‚



ä¾‹å¦‚ï¼Œåœ¨model_responseå‡½æ•°ä¸­ï¼Œé™¤äº†æ›´æ–°stateä¹‹å¤–ï¼Œè¿˜è¿”å›æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bçš„æ›´æ–°åçš„å€¼ã€‚



ä½†å¦‚ä½•æ”¶é›†æ‰€æœ‰æ ‡ç­¾é¡µçš„ç»„ä»¶å‘¢ï¼Ÿå¯èƒ½éœ€è¦å°†build_demoå‡½æ•°ä¿®æ”¹ä¸ºè¿”å›è¿™äº›ç»„ä»¶ï¼Œå¹¶åœ¨ä¸»å‡½æ•°ä¸­æ”¶é›†å®ƒä»¬ã€‚



è¿™å¯èƒ½éœ€è¦åœ¨åˆ›å»ºæ¯ä¸ªé¡µé¢æ—¶ï¼Œå°†å®ƒä»¬çš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶ä¿å­˜åˆ°åˆ—è¡¨ä¸­ï¼Œç„¶ååœ¨model_responseå’Œclear_chatå‡½æ•°ä¸­å¤„ç†è¿™äº›åˆ—è¡¨ã€‚



å…·ä½“ä¿®æ”¹æ­¥éª¤ï¼š



\1. åœ¨build_demoå‡½æ•°ä¸­ï¼Œé™¤äº†åˆ›å»ºé¡µé¢å¤–ï¼Œè¿”å›Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



\2. åœ¨ä¸»å‡½æ•°ä¸­ï¼Œæ”¶é›†æ‰€æœ‰é¡µé¢çš„Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



\3. ä¿®æ”¹model_responseå’Œclear_chatå‡½æ•°ï¼Œæ¥å—è¿™äº›ç»„ä»¶åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›æ›´æ–°åçš„æ‰€æœ‰ç»„ä»¶ã€‚



ä½†è¿™æ ·ä¼šå¤§å¤§å¢åŠ ä»£ç çš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯å¤„ç†å¤šä¸ªè¾“å‡ºç»„ä»¶ã€‚



æˆ–è®¸ï¼Œå¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹å¼ï¼Œåˆ©ç”¨Gradioçš„å…¨å±€å˜é‡æ¥å…±äº«stateï¼Œä½†éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨ç­‰é—®é¢˜ã€‚



ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡æ¥ä¿å­˜user_inputså’Œmodel_A_responsesï¼Œç„¶ååœ¨æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbotç»„ä»¶ä¸­è¯»å–è¿™äº›å…¨å±€å˜é‡æ¥ç”Ÿæˆå†…å®¹ã€‚



ä½†Gradioåœ¨å¤šç”¨æˆ·ç¯å¢ƒä¸‹ï¼Œå…¨å±€å˜é‡ä¼šè¢«æ‰€æœ‰ä¼šè¯å…±äº«ï¼Œè¿™ä¼šå¯¼è‡´ä¸åŒç”¨æˆ·ä¹‹é—´çš„æ•°æ®æ··ä¹±ã€‚å› æ­¤ï¼Œå¿…é¡»ä½¿ç”¨Gradioçš„Stateæœºåˆ¶æ¥ä¿å­˜æ¯ä¸ªä¼šè¯çš„çŠ¶æ€ã€‚



å› æ­¤ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯å°†æ‰€æœ‰éœ€è¦å…±äº«çš„æ•°æ®å­˜å‚¨åœ¨stateä¸­ï¼Œå¹¶åœ¨å„ä¸ªæ ‡ç­¾é¡µä¹‹é—´å…±äº«è¿™ä¸ªstateã€‚



å›åˆ°æœ€åˆçš„æ€è·¯ï¼Œå¯èƒ½éœ€è¦å°†stateæå‡åˆ°TabbedInterfaceçš„çˆ¶ç»„ä»¶ä¸­ï¼Œè¿™æ ·æ‰€æœ‰æ ‡ç­¾é¡µå¯ä»¥è®¿é—®åŒä¸€ä¸ªstateã€‚



ä¾‹å¦‚ï¼Œåœ¨build_demoå‡½æ•°ä¸­ï¼Œä¸å†åˆ›å»ºè‡ªå·±çš„stateï¼Œè€Œæ˜¯æ¥å—ä¸€ä¸ªå¤–éƒ¨çš„stateç»„ä»¶ä½œä¸ºå‚æ•°ã€‚è¿™æ ·ï¼Œæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªstateã€‚



ä½†æ˜¯ï¼Œåœ¨Gradioä¸­ï¼ŒStateç»„ä»¶æ˜¯ç»‘å®šåˆ°ç‰¹å®šçš„Blockså®ä¾‹çš„ã€‚å¦‚æœæ‰€æœ‰æ ‡ç­¾é¡µéƒ½æ˜¯åœ¨åŒä¸€ä¸ªBlockså®ä¾‹ä¸‹åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥å…±äº«åŒä¸€ä¸ªStateç»„ä»¶ã€‚



ä½†ç”¨æˆ·å½“å‰çš„ä»£ç ä¸­ï¼Œæ¯ä¸ªbuild_demoè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„Blockså®ä¾‹ï¼Œå› æ­¤æ¯ä¸ªé¡µé¢æœ‰è‡ªå·±çš„Stateç»„ä»¶ã€‚è¦å…±äº«stateï¼Œå¯èƒ½éœ€è¦å°†æ‰€æœ‰çš„æ ‡ç­¾é¡µæ”¾åœ¨åŒä¸€ä¸ªBlockså®ä¾‹ä¸­ï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡µé¢ä¸€ä¸ªBlocksã€‚



æ‰€ä»¥ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯å°†æ‰€æœ‰æ ‡ç­¾é¡µæ„å»ºåœ¨åŒä¸€ä¸ªBlockså®ä¾‹ä¸‹ï¼Œä½¿ç”¨gr.TabbedInterfaceçš„pageså‚æ•°ï¼Œä½†è¿™äº›pageséœ€è¦æ˜¯gr.Blocksçš„å®ä¾‹ã€‚è¿™å¯èƒ½ä¸å¯è¡Œï¼Œå› ä¸ºgr.TabbedInterfaceæ¥å—çš„æ˜¯gr.Interfaceçš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯gr.Blocksã€‚



æˆ–è€…ï¼Œç”¨æˆ·å½“å‰çš„ä»£ç å°†æ¯ä¸ªé¡µé¢æ„å»ºä¸ºgr.Blockså®ä¾‹ï¼Œç„¶åä½¿ç”¨TabbedInterface(pages, demo_keys)ã€‚ä½†æ¯ä¸ªgr.Blockså®ä¾‹æ˜¯ç‹¬ç«‹çš„ï¼Œæ— æ³•å…±äº«stateã€‚



å› æ­¤ï¼Œå¯èƒ½éœ€è¦é‡æ–°è®¾è®¡æ•´ä¸ªåº”ç”¨çš„ç»“æ„ï¼Œä½¿ç”¨ä¸€ä¸ªé¡¶å±‚çš„gr.Blocksï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ ‡ç­¾é¡µçš„å†…å®¹ï¼Œå¹¶ä¸”è¿™äº›æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªStateç»„ä»¶ã€‚



ä¾‹å¦‚ï¼Œå°†æ•´ä¸ªåº”ç”¨æ„å»ºä¸ºä¸€ä¸ªgr.Blocksï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªgr.Tabç»„ä»¶ï¼Œæ¯ä¸ªTabå¯¹åº”ä¸€ä¸ªæ ‡ç­¾é¡µã€‚è¿™æ ·ï¼Œæ‰€æœ‰Tabå…±äº«åŒä¸€ä¸ªStateç»„ä»¶ï¼Œå› ä¸ºå®ƒä»¬å±äºåŒä¸€ä¸ªBlockså®ä¾‹ã€‚



è¿™å°†æ˜¯ä¸€ä¸ªæ›´å¯è¡Œçš„æ–¹æ¡ˆï¼Œå› ä¸ºæ‰€æœ‰çš„ç»„ä»¶éƒ½åœ¨åŒä¸€ä¸ªBlocksä¸‹ï¼Œstateå¯ä»¥åœ¨æ‰€æœ‰Tabä¹‹é—´å…±äº«ã€‚



æ‰€ä»¥ï¼Œä¿®æ”¹åçš„ç»“æ„åº”è¯¥æ˜¯ï¼š



\- ä¸€ä¸ªé¡¶å±‚çš„gr.BlocksåŒ…å«å¤šä¸ªgr.Tabç»„ä»¶ã€‚



\- æ¯ä¸ªgr.Tabå¯¹åº”ä¸€ä¸ªæ ‡ç­¾é¡µï¼ŒåŒ…å«Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



\- å…±äº«çš„stateç»„ä»¶å­˜å‚¨user_inputså’Œmodel_A_responsesã€‚



\- æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºæ—¶æ ¹æ®è¯¥Tabçš„keyç”Ÿæˆå›å¤ã€‚



è¿™æ ·ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°å…±äº«çš„stateï¼Œæ‰€æœ‰Tabçš„Chatbot_Aæ˜¾ç¤ºç›¸åŒçš„å¯¹è¯å†å²ï¼Œè€Œæ¯ä¸ªTabçš„Chatbot_Bæ ¹æ®å„è‡ªçš„keyç”Ÿæˆå›å¤ã€‚



è¿™å°†ç¡®ä¿æ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä¸ªèŠå¤©è®°å½•ï¼ŒåŒæ—¶æ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bå›å¤å¸¦ä¸Šè‡ªå·±çš„keyã€‚



æ¥ä¸‹æ¥ï¼Œå¦‚ä½•å®ç°æ¯ä¸ªTabçš„Chatbot_Bæ ¹æ®keyç”Ÿæˆå›å¤ï¼Ÿ



æ¯ä¸ªTabçš„Chatbot_Bçš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä»stateä¸­è·å–user_inputsï¼Œå¹¶æ ¹æ®è¯¥Tabçš„keyç”Ÿæˆå›å¤åˆ—è¡¨ã€‚



åœ¨Gradioä¸­ï¼Œå¯ä»¥ä½¿ç”¨gr.renderå‡½æ•°æˆ–åŠ¨æ€ç»„ä»¶æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä½†å¯èƒ½éœ€è¦ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æ›´æ–°ã€‚



å¯èƒ½çš„å®ç°æ–¹æ³•ï¼š



\1. åœ¨é¡¶å±‚çš„gr.Blocksä¸­å®šä¹‰stateç»„ä»¶ï¼Œä¿å­˜user_inputså’Œmodel_A_responsesã€‚



\2. å¯¹äºæ¯ä¸ªæ ‡ç­¾é¡µï¼ˆå³æ¯ä¸ªgr.Tabï¼‰ï¼Œåˆ›å»ºChatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



\3. Chatbot_Açš„valueè®¾ç½®ä¸ºlambda: list(zip(state['user_inputs'], state['model_A_responses']))ã€‚



\4. Chatbot_Bçš„valueè®¾ç½®ä¸ºlambda key: list(zip(state['user_inputs'], [f"B: {key} {input} B" for input in state['user_inputs']]))ï¼Œå…¶ä¸­keyæ˜¯è¯¥æ ‡ç­¾é¡µçš„demo_keyã€‚



\5. å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°stateçš„user_inputså’Œmodel_A_responsesï¼Œè¿™å°†è§¦å‘æ‰€æœ‰Chatbot_Aå’ŒChatbot_Bç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚



ä½†Gradioçš„ç»„ä»¶ä¸æ”¯æŒè¿™æ ·çš„åŠ¨æ€ç»‘å®šï¼Œé™¤éä½¿ç”¨äº‹ä»¶è§¦å‘çš„æ›´æ–°ã€‚



å› æ­¤ï¼Œå¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bç»„ä»¶æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬ï¼Œå½“stateå˜åŒ–æˆ–æ ‡ç­¾é¡µåˆ‡æ¢æ—¶ï¼Œè§¦å‘å…¶æ›´æ–°ã€‚



è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œä½†å¯ä»¥å°è¯•ã€‚



å…·ä½“æ­¥éª¤ï¼š



\1. åœ¨é¡¶å±‚çš„Blocksä¸­å®šä¹‰stateç»„ä»¶ï¼š



state = gr.State({'user_inputs': [], 'model_A_responses': []})



\2. å¯¹äºæ¯ä¸ªdemo_keyï¼Œåˆ›å»ºä¸€ä¸ªgr.Tabï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºChatbot_Aå’ŒChatbot_Bã€‚



\3. Chatbot_Açš„valueç”±stateä¸­çš„user_inputså’Œmodel_A_responsesç”Ÿæˆã€‚



\4. Chatbot_Bçš„valueç”±stateä¸­çš„user_inputså’Œå½“å‰Tabçš„demo_keyç”Ÿæˆã€‚



\5. å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°stateï¼Œç„¶åè§¦å‘æ‰€æœ‰Chatbot_Aå’ŒChatbot_Bçš„æ›´æ–°ã€‚



\6. æ¸…é™¤èŠå¤©è®°å½•æ—¶ï¼Œé‡ç½®stateï¼ŒåŒæ ·è§¦å‘æ‰€æœ‰ç»„ä»¶çš„æ›´æ–°ã€‚



ä½†å¦‚ä½•åœ¨Gradioä¸­å®ç°è¿™äº›åŠ¨æ€æ›´æ–°å‘¢ï¼Ÿ



å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨ç”¨æˆ·å‘é€æ¶ˆæ¯æˆ–æ¸…é™¤è®°å½•æ—¶ï¼Œæ›´æ–°stateï¼Œç„¶åè¿”å›æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bçš„æ›´æ–°åçš„å€¼ã€‚



ä¾‹å¦‚ï¼Œmodel_responseå‡½æ•°ä¸ä»…æ›´æ–°stateï¼Œè¿˜è¿”å›æ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bçš„æ–°å€¼ã€‚



ä½†å¦‚ä½•æ”¶é›†æ‰€æœ‰æ ‡ç­¾é¡µçš„è¿™äº›ç»„ä»¶å‘¢ï¼Ÿéœ€è¦åœ¨æ„å»ºæ¯ä¸ªæ ‡ç­¾é¡µæ—¶ï¼Œå°†å®ƒä»¬çš„Chatbot_Aå’ŒChatbot_Bä¿å­˜åˆ°åˆ—è¡¨ä¸­ï¼Œç„¶ååœ¨model_responseä¸­å¤„ç†è¿™äº›åˆ—è¡¨ã€‚



è¿™å¯èƒ½éœ€è¦åœ¨ä¸»å‡½æ•°ä¸­æ„å»ºæ‰€æœ‰æ ‡ç­¾é¡µï¼Œå¹¶æ”¶é›†å®ƒä»¬çš„ç»„ä»¶ï¼Œç„¶åä¼ é€’ç»™model_responseå’Œclear_chatå‡½æ•°ã€‚



è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œä½†å¯ä»¥å°è¯•ã€‚



ä»£ç ä¿®æ”¹çš„å¤§è‡´æµç¨‹ï¼š



\- åˆ›å»ºä¸€ä¸ªé¡¶å±‚çš„gr.Blockså®ä¾‹ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªgr.Tabï¼Œæ¯ä¸ªTabå¯¹åº”ä¸€ä¸ªdemo_keyã€‚



\- åœ¨é¡¶å±‚Blocksä¸­å®šä¹‰stateç»„ä»¶ã€‚



\- æ¯ä¸ªTabåŒ…å«Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



\- å‘é€æŒ‰é’®å’Œè¾“å…¥æ¡†çš„äº‹ä»¶å¤„ç†å‡½æ•°æ›´æ–°stateï¼Œå¹¶è¿”å›æ‰€æœ‰Tabçš„Chatbot_Aå’ŒChatbot_Bçš„æ›´æ–°åçš„å€¼ã€‚



\- æ¸…é™¤æŒ‰é’®çš„äº‹ä»¶å¤„ç†å‡½æ•°é‡ç½®stateï¼Œå¹¶è¿”å›æ‰€æœ‰ç»„ä»¶çš„ç©ºå€¼ã€‚



å…·ä½“ä»£ç å®ç°ï¼š



\1. å®šä¹‰stateç»“æ„ï¼š



state = gr.State({'user_inputs': [], 'model_A_responses': []})



\2. åˆ›å»ºæ‰€æœ‰æ ‡ç­¾é¡µçš„Tabsï¼Œå¹¶ä¸ºæ¯ä¸ªTabåˆ›å»ºChatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œä¿å­˜åˆ°åˆ—è¡¨ä¸­ã€‚



\3. model_responseå‡½æ•°æ¥æ”¶stateã€textboxï¼Œä»¥åŠæ‰€æœ‰Tabçš„Chatbotç»„ä»¶ï¼Œç„¶åè¿”å›æ›´æ–°åçš„stateå’Œæ‰€æœ‰ç»„ä»¶çš„å€¼ã€‚



ä½†è¿™æ ·ä¼šæ¶‰åŠå¤§é‡çš„è¾“å…¥å’Œè¾“å‡ºç»„ä»¶ï¼Œå¯èƒ½éš¾ä»¥å¤„ç†ã€‚



æˆ–è®¸ï¼Œæ›´ç®€å•çš„æ–¹å¼æ˜¯ï¼Œåœ¨é¡¶å±‚çš„Blocksä¸­ï¼Œä¸ºæ¯ä¸ªTabåˆ›å»ºChatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºè¾“å‡ºç»„ä»¶ã€‚ç„¶åï¼Œå½“å‘é€æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°stateï¼Œå¹¶ç”Ÿæˆæ‰€æœ‰Tabçš„Chatbotç»„ä»¶çš„å€¼ã€‚



ä¾‹å¦‚ï¼š



def model_response(state, textbox, demo_key):

if textbox == '':

return state, []

\# æ›´æ–°state

state['user_inputs'].append(textbox)

state['model_A_responses'].append(textbox)

\# ç”Ÿæˆæ‰€æœ‰Tabçš„Chatbot_Aå’ŒChatbot_Bçš„å€¼

chatbot_A_all = []

chatbot_B_all = []

for key in demo_keys:

chatbot_A = list(zip(state['user_inputs'], state['model_A_responses']))

chatbot_B = [(input, f"B: {key} {input} B") for input in state['user_inputs']]

chatbot_A_all.append(chatbot_A)

chatbot_B_all.append(chatbot_B)

return state, *chatbot_A_all, *chatbot_B_all



ä½†è¿™æ ·éœ€è¦å°†æ‰€æœ‰Chatbotç»„ä»¶ä½œä¸ºè¾“å‡ºï¼Œè¿™å¯èƒ½ä¸ç°å®ï¼Œå› ä¸ºæ•°é‡å¯èƒ½å¾ˆå¤šã€‚



æˆ–è®¸ï¼ŒGradioçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œå½“æœ‰å¾ˆå¤šæ ‡ç­¾é¡µæ—¶ï¼Œè¿™ç§æ–¹æ¡ˆå¯èƒ½ä¸å¯è¡Œã€‚



ç»¼ä¸Šï¼Œå¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘ç”¨æˆ·çš„éœ€æ±‚ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ›´ç®€å•çš„å®ç°æ–¹å¼ã€‚



å¯èƒ½çš„å¦¥åæ–¹æ¡ˆï¼š



è™½ç„¶ç”¨æˆ·å¸Œæœ›æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bçš„å›å¤å¸¦ä¸Šä¸åŒçš„keyï¼Œä½†å®é™…å¯èƒ½åªéœ€è¦åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œæ ¹æ®å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µçš„keyæ¥ç”Ÿæˆå›å¤ï¼Œå¹¶å°†è¯¥å›å¤ä¿å­˜åˆ°stateä¸­ã€‚è¿™æ ·ï¼Œå½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œä¹‹å‰çš„å›å¤ä¸ä¼šè¢«ä¿ç•™ï¼Œåªæœ‰å½“å‰æ´»åŠ¨æ ‡ç­¾é¡µçš„å›å¤ä¼šè¢«ä¿å­˜ã€‚



ä½†è¿™æ ·ä¸ç¬¦åˆç”¨æˆ·çš„éœ€æ±‚ï¼Œç”¨æˆ·å¸Œæœ›ä¿ç•™æ‰€æœ‰æ ‡ç­¾é¡µçš„å›å¤ï¼Œè€Œåˆ‡æ¢æ—¶å¯ä»¥çœ‹åˆ°å†å²è®°å½•ã€‚



å›åˆ°æœ€åˆçš„é—®é¢˜ï¼Œå¯èƒ½ç”¨æˆ·å¸Œæœ›çš„æ˜¯ï¼šæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«åŒä¸€ä»½ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ï¼Œè€Œæ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bçš„å›å¤æ ¹æ®è¯¥æ ‡ç­¾é¡µçš„keyç”Ÿæˆï¼Œä½†ç”Ÿæˆåçš„å›å¤éœ€è¦ä¿å­˜ï¼Œä»¥ä¾¿åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ä¿ç•™ã€‚



ä½†è¿™æ ·éœ€è¦ä¿å­˜æ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bçš„å›å¤ï¼Œå¯¼è‡´stateçš„ç»“æ„å˜å¾—å¤æ‚ï¼Œä¾‹å¦‚ï¼š



state = {

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {

'+negative': [],

'+toxic': [],

\# ...å…¶ä»–keys

}

}



è¿™æ ·ï¼Œæ¯æ¬¡ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œä¸ºæ¯ä¸ªæ ‡ç­¾é¡µçš„keyç”Ÿæˆæ¨¡å‹Bçš„å›å¤ï¼Œå¹¶ä¿å­˜åˆ°stateä¸­ã€‚å½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œæ˜¾ç¤ºè¯¥æ ‡ç­¾é¡µå¯¹åº”çš„model_B_responsesã€‚



è¿™æ ·ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºè¯¥æ ‡ç­¾é¡µçš„model_B_responsesã€‚



è¿™å¯èƒ½æ›´å¯è¡Œï¼Œå› ä¸ºï¼š



\- ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šä¸ºæ‰€æœ‰æ ‡ç­¾é¡µç”Ÿæˆå¯¹åº”çš„æ¨¡å‹Bå›å¤ï¼Œå¹¶ä¿å­˜åˆ°stateä¸­ã€‚



\- æ¸…é™¤èŠå¤©è®°å½•æ—¶ï¼Œé‡ç½®æ‰€æœ‰æ•°æ®ã€‚



è¿™æ ·ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºè‡ªå·±çš„å†å²å›å¤ï¼Œè¿™äº›å›å¤åœ¨å‘é€æ¶ˆæ¯æ—¶ç”Ÿæˆå¹¶ä¿å­˜ã€‚



ä»£ç ä¿®æ”¹æ­¥éª¤ï¼š



\1. ä¿®æ”¹stateç»“æ„ï¼ŒåŒ…å«model_B_responseså­—å…¸ï¼Œæ¯ä¸ªkeyå¯¹åº”ä¸€ä¸ªæ ‡ç­¾é¡µçš„å›å¤åˆ—è¡¨ã€‚



\2. å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯¹æ¯ä¸ªdemo_keyç”Ÿæˆæ¨¡å‹Bçš„å›å¤ï¼Œå¹¶ä¿å­˜åˆ°state['model_B_responses'][key]ä¸­ã€‚



\3. æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºstate['model_B_responses'][key]ã€‚



è¿™æ ·ï¼Œå‘é€æ¶ˆæ¯æ—¶ä¼šä¸ºæ‰€æœ‰æ ‡ç­¾é¡µç”Ÿæˆå›å¤ï¼Œå­˜å‚¨èµ·æ¥ï¼Œåˆ‡æ¢æ ‡ç­¾é¡µæ—¶æ˜¾ç¤ºå¯¹åº”çš„å†å²ã€‚



è¿™éœ€è¦é¢„å…ˆçŸ¥é“æ‰€æœ‰demo_keysï¼Œå¹¶åœ¨å‘é€æ¶ˆæ¯æ—¶ä¸ºæ¯ä¸ªkeyç”Ÿæˆå›å¤ã€‚



ä¾‹å¦‚ï¼Œdemo_keys = ["+positive", "+negative", ...]



åœ¨model_responseå‡½æ•°ä¸­ï¼š



for key in demo_keys:

b_response = f"B: {key} {textbox} B"

state['model_B_responses'][key].append(b_response)



ä½†è¿™æ ·ä¼šå¢åŠ å­˜å‚¨å¼€é”€ï¼Œå°¤å…¶æ˜¯å½“æœ‰å¾ˆå¤šæ ‡ç­¾é¡µæ—¶ï¼Œä½†ç”¨æˆ·ç¤ºä¾‹ä¸­çš„demo_keysæ•°é‡æœ‰é™ï¼Œå¯èƒ½å¯ä»¥æ¥å—ã€‚



å…·ä½“å®ç°ï¼š



ä¿®æ”¹stateçš„ç»“æ„ï¼š



state = gr.State({

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {}

})



åœ¨build_demoå‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–model_B_responsesï¼š



def build_demo(demo_key):

\# åœ¨é¦–æ¬¡æ„å»ºæ—¶ï¼Œåˆå§‹åŒ–model_B_responses[demo_key]ä¸ºç©ºåˆ—è¡¨

\# ä½†éœ€è¦ç¡®ä¿stateæ­£ç¡®åˆå§‹åŒ–

\# å¯èƒ½éœ€è¦åœ¨clear_chatå‡½æ•°ä¸­åˆå§‹åŒ–model_B_responsesæ‰€æœ‰keysçš„ç©ºåˆ—è¡¨



ä½†è¿™æ ·åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¯èƒ½éœ€è¦é¢„å…ˆçŸ¥é“æ‰€æœ‰demo_keysï¼Œè¿™å¯èƒ½éœ€è¦åœ¨ä¸»å‡½æ•°ä¸­å¤„ç†ã€‚



ä¾‹å¦‚ï¼Œåœ¨clear_chatå‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–stateçš„model_B_responsesä¸ºæ¯ä¸ªdemo_keyçš„ç©ºåˆ—è¡¨ï¼š



def clear_chat(state, demo_keys):

if state is not None:

state = {

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

}

return state, ...å…¶ä»–ç»„ä»¶æ›´æ–°



ä½†demo_keyséœ€è¦ä½œä¸ºå‚æ•°ä¼ é€’ç»™clear_chatï¼Œè¿™å¯èƒ½éœ€è¦è°ƒæ•´äº‹ä»¶ç»‘å®šçš„å‚æ•°ã€‚



è¿™ä¼¼ä¹å¯è¡Œï¼Œä½†éœ€è¦è°ƒæ•´ä»£ç ç»“æ„ã€‚



ä¿®æ”¹åçš„ä»£ç æµç¨‹ï¼š



\1. ä¸»å‡½æ•°ä¸­å®šä¹‰demo_keysã€‚



\2. åœ¨clear_chatå‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–stateçš„model_B_responsesä¸ºæ¯ä¸ªdemo_keyçš„ç©ºåˆ—è¡¨ã€‚



\3. åœ¨model_responseå‡½æ•°ä¸­ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œä¸ºæ¯ä¸ªdemo_keyç”Ÿæˆæ¨¡å‹Bçš„å›å¤ï¼Œå¹¶æ·»åŠ åˆ°å¯¹åº”çš„åˆ—è¡¨ä¸­ã€‚



\4. æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aæ˜¾ç¤ºstate['user_inputs']å’Œstate['model_A_responses']çš„zipã€‚



\5. æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºstate['model_B_responses'][demo_key]çš„zip(user_inputs, model_B_responses)ã€‚



è¿™æ ·ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bæ˜¾ç¤ºè‡ªå·±å¯¹åº”çš„å›å¤å†å²ã€‚



è¿™æ ·ï¼Œå½“ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œæ˜¾ç¤ºå¯¹åº”çš„å†å²è®°å½•ï¼Œè€Œè¿™äº›è®°å½•åœ¨å‘é€æ¶ˆæ¯æ—¶å·²ç»ç”Ÿæˆå¹¶ä¿å­˜ã€‚



æ¸…é™¤èŠå¤©è®°å½•æ—¶ï¼Œé‡ç½®æ‰€æœ‰åˆ—è¡¨ã€‚



è¿™å°†æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼šæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bå›å¤æ ¹æ®keyç”Ÿæˆå¹¶ä¿å­˜ï¼Œæ¸…é™¤æ—¶æ•´ä½“åˆ·æ–°ã€‚



ç°åœ¨ï¼Œæ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œä¿®æ”¹ç”¨æˆ·çš„ä»£ç ï¼š



ä¿®æ”¹åçš„stateç»“æ„ï¼š



state = {

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {

'+positive': [],

'+negative': [],

'de-toxic': [],

'+toxic': [],

'+polite': [],

'+impolite': [],

'+support': [],

'+oppose': []

}

}



åœ¨clear_chatå‡½æ•°ä¸­ï¼Œé‡ç½®stateï¼š



def clear_chat(state, demo_keys):

if state is not None:

state['user_inputs'] = []

state['model_A_responses'] = []

for key in demo_keys:

state['model_B_responses'][key] = []

\# è¿”å›æ›´æ–°åçš„stateå’Œç»„ä»¶

return ...



ä½†éœ€è¦å°†demo_keysä¼ é€’ç»™clear_chatå‡½æ•°ï¼Œè¿™å¯èƒ½éœ€è¦è°ƒæ•´äº‹ä»¶ç»‘å®šçš„è¾“å…¥ã€‚



åœ¨model_responseå‡½æ•°ä¸­ï¼Œå½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼š



text = textbox

state['user_inputs'].append(text)

state['model_A_responses'].append(text)  # æ¨¡å‹Aç›´æ¥å›å¤ç›¸åŒå†…å®¹



for key in demo_keys:

b_response = f"B: {key} {text} B"

state['model_B_responses'][key].append(b_response)



ç„¶åï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aæ˜¾ç¤ºzip(user_inputs, model_A_responses)ï¼Œè€ŒChatbot_Bæ˜¾ç¤ºzip(user_inputs, model_B_responses[key]).



è¿™æ ·ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bä¼šæ˜¾ç¤ºå¯¹åº”çš„å›å¤å†å²ã€‚



åœ¨Gradioä¸­ï¼Œè¿™éœ€è¦æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbotç»„ä»¶çš„å€¼æ¥è‡ªstateçš„å¯¹åº”éƒ¨åˆ†ã€‚



å› æ­¤ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„build_demoå‡½æ•°éœ€è¦æ¥æ”¶demo_keyï¼Œå¹¶åˆ›å»ºChatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œå…¶å€¼ä»stateä¸­è·å–ã€‚



ä¿®æ”¹åçš„build_demoå‡½æ•°ï¼š



def build_demo(demo_key):

with gr.Blocks():  # å¯èƒ½ä¸éœ€è¦ï¼Œå› ä¸ºæ ‡ç­¾é¡µåœ¨åŒä¸€ä¸ªé¡¶å±‚Blocksä¸­

\# è¿™äº›ç»„ä»¶å®é™…ä¸Šå±äºé¡¶å±‚çš„Blocks

chatbot_A = gr.Chatbot(label=f'Model A ({demo_key})', height=550)

chatbot_B = gr.Chatbot(label=f'Model B ({demo_key})', height=550)



\# å¦‚ä½•å°†chatbot_Aå’Œchatbot_Bçš„å€¼ç»‘å®šåˆ°stateï¼Ÿ

\# å¯èƒ½éœ€è¦ä½¿ç”¨äº‹ä»¶å¤„ç†å‡½æ•°



ä½†é—®é¢˜åœ¨äºï¼Œå¦‚ä½•è®©æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbotç»„ä»¶æ˜¾ç¤ºå¯¹åº”çš„stateéƒ¨åˆ†ã€‚



å¯èƒ½éœ€è¦åœ¨é¡¶å±‚Blocksä¸­åˆ›å»ºæ‰€æœ‰æ ‡ç­¾é¡µçš„Chatbotç»„ä»¶ï¼Œå¹¶å®šä¹‰å®ƒä»¬çš„å€¼å¦‚ä½•ä»stateä¸­è·å–ã€‚



ä¾‹å¦‚ï¼š



with gr.Blocks() as demo:

state = gr.State({

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

})



\# åˆ›å»ºå„ä¸ªæ ‡ç­¾é¡µ

tabs = []

for key in demo_keys:

with gr.Tab(key):

with gr.Row():

chatbot_A = gr.Chatbot(label=f'Model A', height=550)

chatbot_B = gr.Chatbot(label=f'Model B ({key})', height=550)

\# ä¿å­˜è¿™äº›ç»„ä»¶åˆ°tabsçš„æŸä¸ªç»“æ„ä¸­

tabs.append((chatbot_A, chatbot_B))



\# è¾“å…¥ç»„ä»¶

textbox = gr.Textbox(...)

send_btn = gr.Button(...)

clear_btn = gr.Button(...)



\# äº‹ä»¶ç»‘å®š

send_btn.click(model_response, [state, textbox], [state] + [comp for tab in tabs for comp in tab])

clear_btn.click(clear_chat, [state], [state] + [comp for tab in tabs for comp in tab])



ä½†å¦‚ä½•è®©æ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Bæ˜¾ç¤ºæ­£ç¡®çš„æ•°æ®ï¼Ÿ



æ¯æ¬¡äº‹ä»¶è§¦å‘æ—¶ï¼Œmodel_responseå‡½æ•°éœ€è¦ç”Ÿæˆæ‰€æœ‰Chatbotç»„ä»¶çš„æ›´æ–°åçš„å€¼ã€‚



ä¾‹å¦‚ï¼Œmodel_responseè¿”å›ï¼š



\- æ›´æ–°åçš„state

\- å¯¹äºæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aï¼Œæ˜¾ç¤ºzip(user_inputs, model_A_responses)

\- å¯¹äºæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Bï¼Œæ˜¾ç¤ºzip(user_inputs, model_B_responses[key])



è¿™åœ¨å‡½æ•°ä¸­å¯èƒ½éœ€è¦æ„é€ ä¸€ä¸ªå¾ˆé•¿çš„è¾“å‡ºåˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰Chatbotç»„ä»¶çš„å€¼ã€‚



è¿™å¯èƒ½å¯è¡Œï¼Œä½†ä»£ç ä¼šå˜å¾—å¤æ‚ã€‚



ä¾‹å¦‚ï¼Œmodel_responseå‡½æ•°ï¼š



def model_response(state, textbox):

if textbox == '':

return [state] + [gr.update()] * (len(tabs)*2)  # ä¿æŒæ‰€æœ‰ç»„ä»¶ä¸å˜



\# æ›´æ–°state

state['user_inputs'].append(textbox)

state['model_A_responses'].append(textbox)

for key in demo_keys:

b_res = f"B: {key} {textbox} B"

state['model_B_responses'][key].append(b_res)



\# ç”Ÿæˆæ‰€æœ‰Chatbotç»„ä»¶çš„å€¼

updates = []

for key in demo_keys:

\# Chatbot_Açš„å€¼

a_messages = list(zip(state['user_inputs'], state['model_A_responses']))

updates.append(gr.update(value=a_messages))

\# Chatbot_Bçš„å€¼

b_messages = list(zip(state['user_inputs'], state['model_B_responses'][key]))

updates.append(gr.update(value=b_messages))



return [state] + updates



åŒæ ·ï¼Œclear_chatå‡½æ•°éœ€è¦é‡ç½®stateå¹¶è¿”å›æ‰€æœ‰Chatbotç»„ä»¶çš„ç©ºå€¼ï¼š



def clear_chat(state):

state = {

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

}

updates = []

for key in demo_keys:

updates.append(gr.update(value=[]))

updates.append(gr.update(value=[]))

return [state] + updates



ç„¶åï¼Œåœ¨äº‹ä»¶ç»‘å®šä¸­ï¼Œsend_btn.clickçš„è¾“å‡ºæ˜¯stateåŠ ä¸Šæ‰€æœ‰Chatbot_Aå’ŒChatbot_Bç»„ä»¶ã€‚



è¿™éœ€è¦æ˜ç¡®æŒ‡å®šæ‰€æœ‰è¾“å‡ºç»„ä»¶ï¼Œè¿™åœ¨ä»£ç ä¸­å¯èƒ½éš¾ä»¥åŠ¨æ€å¤„ç†ï¼Œå°¤å…¶æ˜¯å½“demo_keysæ˜¯åŠ¨æ€ç”Ÿæˆæ—¶ã€‚



ç”¨æˆ·å½“å‰çš„ä»£ç ä¸­ï¼Œdemo_keysæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å¯ä»¥æ‰‹åŠ¨å¤„ç†ï¼Œä½†å¦‚æœdemo_keysæ˜¯åŠ¨æ€çš„ï¼Œå¯èƒ½éœ€è¦æ›´çµæ´»çš„ä»£ç ã€‚



ä½†ç”¨æˆ·ç»™å‡ºçš„demo_keysæ˜¯å›ºå®šçš„åˆ—è¡¨ï¼š



demo_keys=["+positive", "+negative", "de-toxic", "+toxic", "+polite", "+impolite", "+support", "+oppose"]



å› æ­¤ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µåˆ›å»ºChatbotç»„ä»¶ï¼Œå¹¶åœ¨model_responseå’Œclear_chatå‡½æ•°ä¸­ç¡¬ç¼–ç å¤„ç†å®ƒä»¬çš„æ›´æ–°ã€‚



ä½†è¿™æ ·ä»£ç ä¼šå˜å¾—å†—é•¿ï¼Œä½†å¯èƒ½æ›´ç®€å•ã€‚



ä¾‹å¦‚ï¼š



with gr.Blocks() as demo:

state = gr.State({

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

})



\# åˆ›å»ºå„ä¸ªæ ‡ç­¾é¡µçš„ç»„ä»¶

tabs = []

for key in demo_keys:

with gr.Tab(key):

with gr.Row():

chatbot_A = gr.Chatbot(label='Model A', height=550)

chatbot_B = gr.Chatbot(label=f'Model B ({key})', height=550)

tabs.append((chatbot_A, chatbot_B))



\# è¾“å…¥ç»„ä»¶

textbox = gr.Textbox(...)

send_btn = gr.Button(...)

clear_btn = gr.Button(...)



\# äº‹ä»¶ç»‘å®š

outputs = [state]

for a, b in tabs:

outputs.append(a)

outputs.append(b)



send_btn.click(model_response, inputs=[state, textbox], outputs=outputs)

clear_btn.click(clear_chat, inputs=[state], outputs=outputs)



ç„¶åï¼Œmodel_responseå‡½æ•°éœ€è¦è¿”å›stateå’Œæ‰€æœ‰Chatbotç»„ä»¶çš„æ›´æ–°ï¼š



def model_response(state, textbox):

if not textbox:

return [state] + [gr.update()]*(len(tabs)*2)



\# æ›´æ–°state

state['user_inputs'].append(textbox)

state['model_A_responses'].append(textbox)

for key in demo_keys:

state['model_B_responses'][key].append(f"B: {key} {textbox} B")



\# ç”Ÿæˆæ›´æ–°åçš„Chatbotå€¼

updates = []

for key in demo_keys:

\# Chatbot_Açš„æ›´æ–°

a_messages = list(zip(state['user_inputs'], state['model_A_responses']))

updates.append(gr.update(value=a_messages))

\# Chatbot_Bçš„æ›´æ–°

b_messages = list(zip(state['user_inputs'], state['model_B_responses'][key]))

updates.append(gr.update(value=b_messages))



return [state] + updates



åŒæ ·ï¼Œclear_chatå‡½æ•°ï¼š



def clear_chat(state):

state = {

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

}

updates = []

for _ in demo_keys:

updates.append(gr.update(value=[]))

updates.append(gr.update(value=[]))

return [state] + updates



è¿™æ ·ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„Chatbot_Aå’ŒChatbot_Béƒ½ä¼šåœ¨å‘é€æ¶ˆæ¯æ—¶æ›´æ–°ï¼Œæ˜¾ç¤ºå…±äº«çš„user_inputså’Œå„è‡ªmodel_B_responsesä¸­çš„å›å¤ã€‚



è¿™åº”è¯¥æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ï¼š



\- æ‰€æœ‰æ ‡ç­¾é¡µå…±äº«ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ã€‚



\- æ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bå›å¤æ ¹æ®è¯¥é¡µçš„demo_keyç”Ÿæˆï¼Œå¹¶ä¿å­˜ï¼Œåˆ‡æ¢æ ‡ç­¾æ—¶ä¿ç•™ã€‚



\- æ¸…é™¤è®°å½•æ—¶é‡ç½®æ‰€æœ‰å†…å®¹ã€‚



ç°åœ¨ï¼Œæ ¹æ®è¿™ä¸ªæ€è·¯ä¿®æ”¹ç”¨æˆ·æä¾›çš„ä»£ç ï¼š



ç”¨æˆ·åŸæ¥çš„ä»£ç ä¸­ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µæ˜¯ç‹¬ç«‹çš„gr.Blockså®ä¾‹ï¼Œè¿™å¯¼è‡´æ— æ³•å…±äº«stateã€‚éœ€è¦å°†æ‰€æœ‰æ ‡ç­¾é¡µæ„å»ºåœ¨åŒä¸€ä¸ªgr.Blockså®ä¾‹ä¸‹ï¼Œä½¿ç”¨gr.Tabç»„ä»¶ã€‚



å› æ­¤ï¼Œè°ƒæ•´build_demoå‡½æ•°ï¼Œæ”¹ä¸ºåœ¨åŒä¸€ä¸ªBlocksä¸­åˆ›å»ºå¤šä¸ªgr.Tabã€‚



æœ€ç»ˆçš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š



import gradio as gr



demo_keys = ["+positive", "+negative", "de-toxic", "+toxic", "+polite", "+impolite", "+support", "+oppose"]



def clear_chat(state):

\# é‡ç½®çŠ¶æ€

state = {

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

}

\# ç”Ÿæˆæ‰€æœ‰Chatbotç»„ä»¶çš„ç©ºå€¼æ›´æ–°

updates = []

for _ in demo_keys:

updates.append(gr.Chatbot.update(value=[]))  # Chatbot_A

updates.append(gr.Chatbot.update(value=[]))  # Chatbot_B

return [state] + updates



def model_response(state, textbox):

if textbox.strip() == '':

return [state] + [gr.update()] * (len(demo_keys)*2)



\# æ›´æ–°ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤

state['user_inputs'].append(textbox)

state['model_A_responses'].append(textbox)



\# æ›´æ–°æ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bå›å¤

for key in demo_keys:

b_response = f"B: {key} {textbox} B"

state['model_B_responses'][key].append(b_response)



\# ç”Ÿæˆæ‰€æœ‰Chatbotç»„ä»¶çš„æ›´æ–°

updates = []

for key in demo_keys:

\# Chatbot_Açš„æ›´æ–°

a_messages = list(zip(state['user_inputs'], state['model_A_responses']))

updates.append(gr.Chatbot.update(value=a_messages))

\# Chatbot_Bçš„æ›´æ–°

b_messages = list(zip(state['user_inputs'], state['model_B_responses'][key]))

updates.append(gr.Chatbot.update(value=b_messages))



return [state] + updates



def build_demo():

with gr.Blocks(theme='snehilsanyal/scikit-learn', title='Text-only Chatbot Arena') as demo:

state = gr.State({

'user_inputs': [],

'model_A_responses': [],

'model_B_responses': {key: [] for key in demo_keys}

})



\# æ ‡é¢˜

gr.HTML("<h1>Text-only Chatbot Arena</h1>")



\# åˆ›å»ºå„ä¸ªæ ‡ç­¾é¡µ

tabs = []

with gr.Tabs() as tabbed_interface:

for key in demo_keys:

with gr.Tab(key):

with gr.Row():

chatbot_A = gr.Chatbot(label='Model A', height=550)

chatbot_B = gr.Chatbot(label=f'Model B ({key})', height=550)

tabs.extend([chatbot_A, chatbot_B])



\# è¾“å…¥åŒºåŸŸ

with gr.Row():

textbox = gr.Textbox(

show_label=False,

placeholder="Enter text and press ENTER",

container=False

)

send_btn = gr.Button(value="Send", variant="primary")



\# æ¸…é™¤æŒ‰é’®

clear_btn = gr.Button(value="ğŸ—‘ï¸ Clear history")



\# ç¤ºä¾‹

gr.Examples(

examples=[

["Hello, how are you?"],

["What's the weather like today?"]

],

inputs=[textbox]

)



\# äº‹ä»¶ç»‘å®š

inputs = [state, textbox]

outputs = [state] + tabs



send_btn.click(

model_response,

inputs=inputs,

outputs=outputs

)

textbox.submit(

model_response,

inputs=inputs,

outputs=outputs

)

clear_btn.click(

clear_chat,

inputs=[state],

outputs=outputs

)



return demo



if __name__ == "__main__":

demo = build_demo()

demo.launch(server_name="0.0.0.0", server_port=8000, debug=True)



åœ¨è¿™ä¸ªä¿®æ”¹åçš„ä»£ç ä¸­ï¼š



\- æ‰€æœ‰æ ‡ç­¾é¡µéƒ½åœ¨åŒä¸€ä¸ªgr.Blockså®ä¾‹ä¸‹åˆ›å»ºï¼Œä½¿ç”¨gr.Tabså’Œgr.Tabã€‚



\- æ¯ä¸ªæ ‡ç­¾é¡µåŒ…å«Chatbot_Aå’ŒChatbot_Bç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶è¢«æ”¶é›†åˆ°tabsåˆ—è¡¨ä¸­ã€‚



\- stateä¿å­˜user_inputsã€model_A_responseså’Œmodel_B_responsesï¼ˆæ¯ä¸ªkeyå¯¹åº”ä¸€ä¸ªåˆ—è¡¨ï¼‰ã€‚



\- model_responseå‡½æ•°åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„model_B_responsesã€‚



\- æ¯æ¬¡äº‹ä»¶ï¼ˆå‘é€æ¶ˆæ¯æˆ–æ¸…é™¤ï¼‰è§¦å‘æ—¶ï¼Œæ‰€æœ‰Chatbotç»„ä»¶éƒ½ä¼šè¢«æ›´æ–°ï¼Œæ˜¾ç¤ºæœ€æ–°çš„æ•°æ®ã€‚



è¿™æ ·ï¼Œæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹Açš„å›å¤ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µçš„æ¨¡å‹Bå›å¤æ ¹æ®å…¶keyç”Ÿæˆï¼Œå¹¶ä¸”å†å²è®°å½•åœ¨åˆ‡æ¢æ ‡ç­¾æ—¶ä¿ç•™ã€‚æ¸…é™¤è®°å½•æ—¶ï¼Œæ‰€æœ‰å†…å®¹è¢«é‡ç½®ã€‚
```

ä»¥ä¸‹æ˜¯ä¿®æ”¹åçš„ä»£ç ï¼Œå®ç°å¤šæ ‡ç­¾é¡µå…±äº«èŠå¤©è®°å½•å¹¶æ ¹æ®å½“å‰æ ‡ç­¾é¡µæ˜¾ç¤ºä¸åŒå‰ç¼€çš„åŠŸèƒ½ï¼š

```python
import gradio as gr

# å…¨å±€å®šä¹‰æ ‡ç­¾é¡µçš„keys
DEMO_KEYS = ["+positive", "+negative", "de-toxic", "+toxic", 
            "+polite", "+impolite", "+support", "+oppose"]

def clear_chat(state):
    """æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å’ŒçŠ¶æ€"""
    # é‡ç½®çŠ¶æ€æ•°æ®ç»“æ„
    state = {
        "user_inputs": [],          # ä¿å­˜æ‰€æœ‰ç”¨æˆ·è¾“å…¥
        "model_A_responses": [],    # ä¿å­˜æ¨¡å‹Açš„æ‰€æœ‰å›å¤
        "model_B_responses": {k: [] for k in DEMO_KEYS}  # ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µä¿å­˜æ¨¡å‹Bçš„å›å¤
    }
    
    # ç”Ÿæˆæ‰€æœ‰éœ€è¦æ¸…ç©ºçš„ç»„ä»¶æ›´æ–°æŒ‡ä»¤
    updates = [state] + [
        gr.update(value=None)       # æ¸…ç©ºè¾“å…¥æ¡†
    ] + [
        gr.update(value=[]) for _ in range(len(DEMO_KEYS)*2)  # æ¸…ç©ºæ‰€æœ‰èŠå¤©æ¡†
    ]
    return updates

def model_response(state, textbox, current_tab):
    """å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶ç”Ÿæˆå“åº”"""
    if not textbox.strip():
        return [state] + [gr.update()]*(len(DEMO_KEYS)*2 + 1)
    
    # ä¿å­˜ç”¨æˆ·è¾“å…¥
    state["user_inputs"].append(textbox)
    
    # ç”Ÿæˆæ¨¡å‹Açš„å“åº”ï¼ˆç›´æ¥é‡å¤ï¼‰
    model_a_response = textbox
    state["model_A_responses"].append(model_a_response)
    
    # ä¸ºæ‰€æœ‰æ ‡ç­¾é¡µç”Ÿæˆæ¨¡å‹Bçš„å“åº”ï¼ˆå¸¦å½“å‰æ ‡ç­¾å‰ç¼€ï¼‰
    for key in DEMO_KEYS:
        model_b_response = f"{key}: {textbox}"  # æ ¹æ®å½“å‰æ ‡ç­¾ç”Ÿæˆå“åº”
        state["model_B_responses"][key].append(model_b_response)
    
    # ç”Ÿæˆç»„ä»¶æ›´æ–°åˆ—è¡¨
    updates = [state, gr.update(value="")]
    
    # æ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„èŠå¤©è®°å½•
    for key in DEMO_KEYS:
        # æ¨¡å‹Açš„èŠå¤©è®°å½•ï¼ˆæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«ï¼‰
        updates.append(
            gr.Chatbot.update(value=list(zip(state["user_inputs"], state["model_A_responses"]))
        # æ¨¡å‹Bçš„èŠå¤©è®°å½•ï¼ˆæ¯ä¸ªæ ‡ç­¾é¡µç‹¬ç«‹ï¼‰
        updates.append(
            gr.Chatbot.update(value=list(zip(state["user_inputs"], state["model_B_responses"][key])))
    
    return updates

def build_tabbed_interface():
    """æ„å»ºå¸¦æœ‰å¤šä¸ªæ ‡ç­¾é¡µçš„ç•Œé¢"""
    with gr.Blocks(theme='snehilsanyal/scikit-learn', title='Multi-Tab Chat Arena') as demo:
        # åˆå§‹åŒ–çŠ¶æ€
        state = gr.State({
            "user_inputs": [],
            "model_A_responses": [],
            "model_B_responses": {k: [] for k in DEMO_KEYS}
        })
        
        # æ ‡é¢˜
        gr.Markdown("# Multi-Tab Chat Arena")
        
        # åˆ›å»ºæ ‡ç­¾é¡µ
        tabs = []
        with gr.Tabs() as tabbed_interface:
            for key in DEMO_KEYS:
                with gr.Tab(key):
                    with gr.Row():
                        chatbot_a = gr.Chatbot(label=f"Model A", height=500)
                        chatbot_b = gr.Chatbot(label=f"Model B - {key}", height=500)
                    tabs.extend([chatbot_a, chatbot_b])
        
        # è¾“å…¥åŒºåŸŸ
        with gr.Row():
            textbox = gr.Textbox(
                show_label=False,
                placeholder="Enter text and press ENTER",
                container=False,
                scale=7
            )
            send_btn = gr.Button("Send", variant="primary", scale=1)
        
        # æ§åˆ¶æŒ‰é’®
        clear_btn = gr.Button("ğŸ—‘ï¸ Clear History")
        
        # ç¤ºä¾‹è¾“å…¥
        gr.Examples(
            examples=[
                ["Hello! How are you?"],
                ["Tell me a joke"],
                ["What's the weather like today?"]
            ],
            inputs=[textbox]
        )
        
        # ç»„ä»¶æ›´æ–°åˆ—è¡¨ï¼ˆçŠ¶æ€ + è¾“å…¥æ¡† + æ‰€æœ‰èŠå¤©ç»„ä»¶ï¼‰
        all_outputs = [state, textbox] + tabs
        
        # äº‹ä»¶ç»‘å®š
        textbox.submit(
            model_response,
            [state, textbox, tabbed_interface],
            all_outputs
        )
        send_btn.click(
            model_response,
            [state, textbox, tabbed_interface],
            all_outputs
        )
        clear_btn.click(
            clear_chat,
            [state],
            all_outputs
        )
    
    return demo

if __name__ == "__main__":
    demo = build_tabbed_interface()
    demo.launch(
        server_name="0.0.0.0",
        server_port=8000,
        share=False,
        debug=True
    )
```

ä¸»è¦æ”¹è¿›ç‚¹ï¼š

1. **å…±äº«æ¶ˆæ¯è®°å½•**ï¼š
   - ä½¿ç”¨å…¨å±€çŠ¶æ€å¯¹è±¡å­˜å‚¨æ‰€æœ‰ç”¨æˆ·è¾“å…¥å’Œæ¨¡å‹å“åº”
   - `state`åŒ…å«ï¼š
     - `user_inputs`: æ‰€æœ‰ç”¨æˆ·è¾“å…¥
     - `model_A_responses`: æ¨¡å‹Açš„å“åº”ï¼ˆæ‰€æœ‰æ ‡ç­¾é¡µå…±äº«ï¼‰
     - `model_B_responses`: æ¯ä¸ªæ ‡ç­¾é¡µå¯¹åº”çš„æ¨¡å‹Bå“åº”

2. **æ ‡ç­¾é¡µç‰¹å®šå“åº”**ï¼š
   - æ¨¡å‹Bçš„å“åº”ä¼šæ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyç”Ÿæˆå‰ç¼€
   - ä½¿ç”¨å­—å…¸å­˜å‚¨ä¸åŒæ ‡ç­¾é¡µçš„å“åº”å†å²

3. **åŒæ­¥æ›´æ–°æœºåˆ¶**ï¼š
   - ä»»ä½•æ ‡ç­¾é¡µçš„è¾“å…¥éƒ½ä¼šæ›´æ–°å…¨å±€çŠ¶æ€
   - æ¯æ¬¡äº¤äº’åæ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µçš„èŠå¤©è®°å½•æ˜¾ç¤º

4. **çŠ¶æ€ç®¡ç†**ï¼š
   - ä½¿ç”¨`gr.State`ç®¡ç†å¤æ‚çš„æ•°æ®ç»“æ„
   - æ¸…ç©ºæ“ä½œä¼šé‡ç½®æ‰€æœ‰å†å²è®°å½•

5. **ç•Œé¢ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨`gr.Tabs`åˆ›å»ºæ ‡ç­¾é¡µç•Œé¢
   - ç»Ÿä¸€é£æ ¼çš„ç»„ä»¶å¸ƒå±€
   - å“åº”å¼è®¾è®¡

ä½¿ç”¨æ–¹æ³•ï¼š
1. åœ¨ä»»æ„æ ‡ç­¾é¡µè¾“å…¥æ¶ˆæ¯ï¼Œæ‰€æœ‰æ ‡ç­¾é¡µéƒ½ä¼šåŒæ­¥æ˜¾ç¤ºå†å²è®°å½•
2. æ¨¡å‹Açš„å›å¤åœ¨æ‰€æœ‰æ ‡ç­¾é¡µä¿æŒä¸€è‡´
3. æ¨¡å‹Bçš„å›å¤ä¼šæ ¹æ®å½“å‰æ ‡ç­¾é¡µçš„keyæ˜¾ç¤ºä¸åŒå‰ç¼€
4. ç‚¹å‡»"Clear History"ä¼šæ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•

æ³¨æ„ï¼šå®é™…è¿è¡Œå‰éœ€è¦ç¡®ä¿å·²å®‰è£…æœ€æ–°ç‰ˆGradioï¼š
```bash
pip install gradio --upgrade
```